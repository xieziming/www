<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>测试 &#8211; 谢子明</title>
	<atom:link href="http://www.xieziming.com/topic/testing/feed" rel="self" type="application/rss+xml" />
	<link>http://www.xieziming.com</link>
	<description>Suny Xie</description>
	<lastBuildDate>Mon, 26 Dec 2016 16:05:06 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=4.7</generator>
	<item>
		<title>UI Automation自定义控件处理</title>
		<link>http://www.xieziming.com/archives/9488.html</link>
		<comments>http://www.xieziming.com/archives/9488.html#respond</comments>
		<pubDate>Fri, 07 Aug 2015 09:10:34 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[Automation]]></category>
		<category><![CDATA[UI Automation]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=9488</guid>
		<description><![CDATA[在做Wpf/Winform UI自动化测试的时候，我们往往不得不面对一个非标准的控件，通过常规的方法我们是得不到控件信息的。下面是一个解决方法：

（1）在被测软件该控件类上通过实现接口添加对自动化的支持。
<code lang="csharp">
protected override System.Windows.Automation.Peers.AutomationPeer OnCreateAutomationPeer() 
{ 
     ImprovedPivotGridAutomationPeer peer = new ImprovedPivotGridAutomationPeer(gridPresenter); 
     peer.InvalidatePeer(); 
     return peer; 
}  
</code>]]></description>
				<content:encoded><![CDATA[<p>在做Wpf/Winform UI自动化测试的时候，我们往往不得不面对一个非标准的控件，通过常规的方法我们是得不到控件信息的。下面是一个解决方法：</p>
<p>（1）在被测软件该控件类上通过实现接口添加对自动化的支持。</p>

<div class="wp_code"><div class="pre"><pre class="csharp" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #000000;">System</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Windows</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Automation</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Peers</span><span style="color: #008000;">.</span><span style="color: #0000FF;">AutomationPeer</span> OnCreateAutomationPeer<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
<span style="color: #008000;">&#123;</span> 
     ImprovedPivotGridAutomationPeer peer <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> ImprovedPivotGridAutomationPeer<span style="color: #008000;">&#40;</span>gridPresenter<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
     peer<span style="color: #008000;">.</span><span style="color: #0000FF;">InvalidatePeer</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
     <span style="color: #0600FF; font-weight: bold;">return</span> peer<span style="color: #008000;">;</span> 
<span style="color: #008000;">&#125;</span></pre></div></div>

<p>接口实现：</p>

<div class="wp_code"><div class="pre"><pre class="csharp" style="font-family:'Times New Roman',Garamond, Times;">  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> ImprovedPivotGridAutomationPeer <span style="color: #008000;">:</span> AutomationPeer 
    <span style="color: #008000;">&#123;</span> 
        ImprovedGridPresenter gridPresenter<span style="color: #008000;">;</span> 
        List<span style="color: #008000;">&lt;</span>AutomationPeer<span style="color: #008000;">&gt;</span> children <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span> 
        <span style="color: #0600FF; font-weight: bold;">public</span> ImprovedPivotGridAutomationPeer<span style="color: #008000;">&#40;</span>ImprovedGridPresenter gridPresenter<span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">this</span><span style="color: #008000;">.</span><span style="color: #0000FF;">gridPresenter</span> <span style="color: #008000;">=</span> gridPresenter<span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">string</span> GetAcceleratorKeyCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Empty</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">string</span> GetAccessKeyCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Empty</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> AutomationControlType GetAutomationControlTypeCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> AutomationControlType<span style="color: #008000;">.</span><span style="color: #0000FF;">DataGrid</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">string</span> GetAutomationIdCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #666666;">&quot;ImprovedPivotGrid&quot;</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> Rect GetBoundingRectangleCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> Rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Empty</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> List<span style="color: #008000;">&lt;</span>AutomationPeer<span style="color: #008000;">&gt;</span> GetChildrenCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            children <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> List<span style="color: #008000;">&lt;</span>AutomationPeer<span style="color: #008000;">&gt;</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
            <span style="color: #0600FF; font-weight: bold;">for</span><span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">int</span> i<span style="color: #008000;">=</span><span style="color: #FF0000;">0</span><span style="color: #008000;">;</span> i<span style="color: #008000;">&lt;</span>gridPresenter<span style="color: #008000;">.</span><span style="color: #0000FF;">GridMetrics</span><span style="color: #008000;">.</span><span style="color: #0000FF;">RowCount</span><span style="color: #008000;">;</span>i<span style="color: #008000;">++</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#123;</span> 
                <span style="color: #0600FF; font-weight: bold;">for</span> <span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">int</span> j<span style="color: #008000;">=</span><span style="color: #FF0000;">0</span><span style="color: #008000;">;</span> j<span style="color: #008000;">&lt;</span>gridPresenter<span style="color: #008000;">.</span><span style="color: #0000FF;">GridMetrics</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ColumnCount</span><span style="color: #008000;">;</span>j<span style="color: #008000;">++</span><span style="color: #008000;">&#41;</span> 
                <span style="color: #008000;">&#123;</span> 
                    <span style="color: #0600FF; font-weight: bold;">try</span> 
                    <span style="color: #008000;">&#123;</span> 
                        CellData cellData <span style="color: #008000;">=</span> gridPresenter<span style="color: #008000;">.</span><span style="color: #0000FF;">GetCellData</span><span style="color: #008000;">&#40;</span>j, i<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
                        <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>cellData<span style="color: #008000;">.</span><span style="color: #0000FF;">CellType</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Equals</span><span style="color: #008000;">&#40;</span>CellType<span style="color: #008000;">.</span><span style="color: #0000FF;">RowHeader</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">||</span> cellData<span style="color: #008000;">.</span><span style="color: #0000FF;">CellType</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Equals</span><span style="color: #008000;">&#40;</span>CellType<span style="color: #008000;">.</span><span style="color: #0000FF;">ColumnHeader</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">||</span> cellData<span style="color: #008000;">.</span><span style="color: #0000FF;">CellType</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Equals</span><span style="color: #008000;">&#40;</span>CellType<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Value</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> 
                        <span style="color: #008000;">&#123;</span> 
                            children<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Add</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">new</span> ImprovedPivotGridCellAutomationPeer<span style="color: #008000;">&#40;</span>gridPresenter, cellData<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
                        <span style="color: #008000;">&#125;</span> 
                    <span style="color: #008000;">&#125;</span> 
                    <span style="color: #0600FF; font-weight: bold;">catch</span> 
                    <span style="color: #008000;">&#123;</span> 
                        <span style="color: #008080; font-style: italic;">//if error </span>
                    <span style="color: #008000;">&#125;</span> 
                <span style="color: #008000;">&#125;</span>                        
            <span style="color: #008000;">&#125;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> children<span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> Point GetClickablePointCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">new</span> Point<span style="color: #008000;">&#40;</span><span style="color: #FF0000;">0</span>, <span style="color: #FF0000;">0</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">string</span> GetHelpTextCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Empty</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">string</span> GetItemStatusCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Empty</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">string</span> GetItemTypeCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Empty</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> AutomationPeer GetLabeledByCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">this</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">string</span> GetNameCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #666666;">&quot;ImprovedPivotGrid&quot;</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">string</span> GetClassNameCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> gridPresenter<span style="color: #008000;">.</span><span style="color: #0000FF;">GetType</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ToString</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> AutomationOrientation GetOrientationCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> AutomationOrientation<span style="color: #008000;">.</span><span style="color: #0000FF;">None</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">object</span> GetPattern<span style="color: #008000;">&#40;</span>PatternInterface patternInterface<span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>patternInterface <span style="color: #008000;">==</span> PatternInterface<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Value</span><span style="color: #008000;">&#41;</span> 
            <span style="color: #008000;">&#123;</span> 
                <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">new</span> ImprovedPivotGridValuePattern<span style="color: #008000;">&#40;</span>gridPresenter<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
            <span style="color: #008000;">&#125;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">bool</span> HasKeyboardFocusCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">bool</span> IsContentElementCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">bool</span> IsControlElementCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">bool</span> IsEnabledCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">bool</span> IsKeyboardFocusableCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">bool</span> IsOffscreenCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">bool</span> IsPasswordCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">bool</span> IsRequiredForFormCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">void</span> SetFocusCore<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
&nbsp;
        <span style="color: #008000;">&#125;</span> 
    <span style="color: #008000;">&#125;</span> 
&nbsp;
    <span style="color: #008000;">&#91;</span>ComVisible<span style="color: #008000;">&#40;</span><span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#93;</span> 
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> ImprovedPivotGridValuePattern <span style="color: #008000;">:</span> IValueProvider 
    <span style="color: #008000;">&#123;</span> 
        ImprovedGridPresenter gridPresenter<span style="color: #008000;">;</span> 
        <span style="color: #0600FF; font-weight: bold;">public</span> ImprovedPivotGridValuePattern<span style="color: #008000;">&#40;</span>ImprovedGridPresenter gridPresenter<span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">this</span><span style="color: #008000;">.</span><span style="color: #0000FF;">gridPresenter</span> <span style="color: #008000;">=</span> gridPresenter<span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
        <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">bool</span> IsReadOnly <span style="color: #008000;">&#123;</span> <span style="color: #0600FF; font-weight: bold;">get</span> <span style="color: #008000;">&#123;</span> <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span> <span style="color: #008000;">&#125;</span> <span style="color: #008000;">&#125;</span> 
        <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">string</span> <span style="color: #0600FF; font-weight: bold;">Value</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">get</span> 
            <span style="color: #008000;">&#123;</span> 
                <span style="color: #0600FF; font-weight: bold;">return</span> gridPresenter<span style="color: #008000;">.</span><span style="color: #0000FF;">GridMetrics</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ColumnCount</span> <span style="color: #008000;">+</span> <span style="color: #666666;">&quot; : &quot;</span> <span style="color: #008000;">+</span> gridPresenter<span style="color: #008000;">.</span><span style="color: #0000FF;">GridMetrics</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ColumnCount</span> <span style="color: #008000;">;</span> 
            <span style="color: #008000;">&#125;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">void</span> SetValue<span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">string</span> <span style="color: #0600FF; font-weight: bold;">value</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span> <span style="color: #0600FF; font-weight: bold;">return</span><span style="color: #008000;">;</span> <span style="color: #008000;">&#125;</span> 
    <span style="color: #008000;">&#125;</span></pre></div></div>

<p>同时，如果只是想暴露一些application的信息，我们可以通过在某控件上（xaml文件）绑定/添加一个<strong>AutomationProperties.HelpText</strong>属性。该属性不会有任何的UI影响，但却可以通过UI Automation的Property取出。</p>
<p>例如：<br />
Main.xaml</p>

<div class="wp_code"><div class="pre"><pre class="csharp" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #008000;">&lt;</span>TextBlock FontSize<span style="color: #008000;">=</span><span style="color: #666666;">&quot;8&quot;</span> Text<span style="color: #008000;">=</span><span style="color: #666666;">&quot;{Binding Type}&quot;</span> AutomationProperties<span style="color: #008000;">.</span><span style="color: #0000FF;">HelpText</span><span style="color: #008000;">=</span><span style="color: #666666;">&quot;{Binding yourWord}&quot;</span><span style="color: #008000;">&gt;</span></pre></div></div>

<p>Main.cs</p>

<div class="wp_code"><div class="pre"><pre class="csharp" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">String</span> myWord
<span style="color: #008000;">&#123;</span>
    <span style="color: #0600FF; font-weight: bold;">get</span>
    <span style="color: #008000;">&#123;</span>
        <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #666666;">&quot;hello world!&quot;</span>
    <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span>
&nbsp;
然后呢，我们就可以在客户端用HelpText等property取出这些特意暴露出来的值了。</pre></div></div>

]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/9488.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>UI Automation通过相对位置来进行对象识别</title>
		<link>http://www.xieziming.com/archives/9487.html</link>
		<comments>http://www.xieziming.com/archives/9487.html#respond</comments>
		<pubDate>Sun, 07 Jun 2015 09:08:24 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[Automation]]></category>
		<category><![CDATA[UI Automation]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=9487</guid>
		<description><![CDATA[下面这个类是用来辅助我们通过相对位置关系来找控件。

<code lang="csharp">
class LocationFinder 
    { 
        AutomationElement element; 
        public LocationFinder(AutomationElement element) 
        { 
            this.element = element; 
        } 

        public AutomationElement getWindow(AutomationElement element) 
        { 
            TreeWalker tWalker = TreeWalker.ControlViewWalker; 
            AutomationElement parentItem = tWalker.GetParent(element); 
            if (!parentItem.Current.ControlType.Equals(ControlType.Window)) 
            { 
                return getWindow(parentItem); 
            } 
            return parentItem; 
        } 
</code>]]></description>
				<content:encoded><![CDATA[<p>下面这个类是用来辅助我们通过相对位置关系来找控件。</p>

<div class="wp_code"><div class="pre"><pre class="csharp" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #6666cc; font-weight: bold;">class</span> LocationFinder 
    <span style="color: #008000;">&#123;</span> 
        AutomationElement element<span style="color: #008000;">;</span> 
        <span style="color: #0600FF; font-weight: bold;">public</span> LocationFinder<span style="color: #008000;">&#40;</span>AutomationElement element<span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            <span style="color: #0600FF; font-weight: bold;">this</span><span style="color: #008000;">.</span><span style="color: #0000FF;">element</span> <span style="color: #008000;">=</span> element<span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">public</span> AutomationElement getWindow<span style="color: #008000;">&#40;</span>AutomationElement element<span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            TreeWalker tWalker <span style="color: #008000;">=</span> TreeWalker<span style="color: #008000;">.</span><span style="color: #0000FF;">ControlViewWalker</span><span style="color: #008000;">;</span> 
            AutomationElement parentItem <span style="color: #008000;">=</span> tWalker<span style="color: #008000;">.</span><span style="color: #0000FF;">GetParent</span><span style="color: #008000;">&#40;</span>element<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
            <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">!</span>parentItem<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ControlType</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Equals</span><span style="color: #008000;">&#40;</span>ControlType<span style="color: #008000;">.</span><span style="color: #0000FF;">Window</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> 
            <span style="color: #008000;">&#123;</span> 
                <span style="color: #0600FF; font-weight: bold;">return</span> getWindow<span style="color: #008000;">&#40;</span>parentItem<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
            <span style="color: #008000;">&#125;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> parentItem<span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">public</span> AutomationElement getSameXAutomationElement<span style="color: #008000;">&#40;</span>ControlType controlType, LocationDirection direction<span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            List<span style="color: #008000;">&lt;</span>AutomationElement<span style="color: #008000;">&gt;</span> xelements <span style="color: #008000;">=</span> getSameXAutomationElement<span style="color: #008000;">&#40;</span>controlType<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
            <span style="color: #0600FF; font-weight: bold;">foreach</span> <span style="color: #008000;">&#40;</span>AutomationElement xelement <span style="color: #0600FF; font-weight: bold;">in</span> xelements<span style="color: #008000;">&#41;</span> 
            <span style="color: #008000;">&#123;</span> 
                <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>xelement<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ControlType</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Equals</span><span style="color: #008000;">&#40;</span>controlType<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> 
                <span style="color: #008000;">&#123;</span> 
                    <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#40;</span>xelement<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">BoundingRectangle</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Top</span> <span style="color: #008000;">-</span> element<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">BoundingRectangle</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Top</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&gt;</span> <span style="color: #FF0000;">2</span> <span style="color: #008000;">&amp;&amp;</span> direction<span style="color: #008000;">.</span><span style="color: #0000FF;">Equals</span><span style="color: #008000;">&#40;</span>LocationDirection<span style="color: #008000;">.</span><span style="color: #0000FF;">UP</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #0600FF; font-weight: bold;">return</span> xelement<span style="color: #008000;">;</span> 
                    <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#40;</span>element<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">BoundingRectangle</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Top</span> <span style="color: #008000;">-</span> xelement<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">BoundingRectangle</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Top</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&gt;</span> <span style="color: #FF0000;">2</span> <span style="color: #008000;">&amp;&amp;</span> direction<span style="color: #008000;">.</span><span style="color: #0000FF;">Equals</span><span style="color: #008000;">&#40;</span>LocationDirection<span style="color: #008000;">.</span><span style="color: #0000FF;">DOWN</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #0600FF; font-weight: bold;">return</span> xelement<span style="color: #008000;">;</span> 
                <span style="color: #008000;">&#125;</span> 
            <span style="color: #008000;">&#125;</span> 
&nbsp;
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">public</span> AutomationElement getSameYAutomationElement<span style="color: #008000;">&#40;</span>ControlType controlType, LocationDirection direction<span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            List<span style="color: #008000;">&lt;</span>AutomationElement<span style="color: #008000;">&gt;</span> yelements <span style="color: #008000;">=</span> getSameYAutomationElement<span style="color: #008000;">&#40;</span>controlType<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
            <span style="color: #0600FF; font-weight: bold;">foreach</span> <span style="color: #008000;">&#40;</span>AutomationElement yelement <span style="color: #0600FF; font-weight: bold;">in</span> yelements<span style="color: #008000;">&#41;</span> 
            <span style="color: #008000;">&#123;</span> 
                <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>yelement<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ControlType</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Equals</span><span style="color: #008000;">&#40;</span>controlType<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> 
                <span style="color: #008000;">&#123;</span> 
                    <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#40;</span>yelement<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">BoundingRectangle</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Left</span> <span style="color: #008000;">-</span> element<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">BoundingRectangle</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Left</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&gt;</span> <span style="color: #FF0000;">2</span> <span style="color: #008000;">&amp;&amp;</span> direction<span style="color: #008000;">.</span><span style="color: #0000FF;">Equals</span><span style="color: #008000;">&#40;</span>LocationDirection<span style="color: #008000;">.</span><span style="color: #0000FF;">RIGHT</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #0600FF; font-weight: bold;">return</span> yelement<span style="color: #008000;">;</span> 
                    <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#40;</span>element<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">BoundingRectangle</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Left</span> <span style="color: #008000;">-</span> yelement<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">BoundingRectangle</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Left</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&gt;</span> <span style="color: #FF0000;">2</span> <span style="color: #008000;">&amp;&amp;</span> direction<span style="color: #008000;">.</span><span style="color: #0000FF;">Equals</span><span style="color: #008000;">&#40;</span>LocationDirection<span style="color: #008000;">.</span><span style="color: #0000FF;">LEFT</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #0600FF; font-weight: bold;">return</span> yelement<span style="color: #008000;">;</span> 
                <span style="color: #008000;">&#125;</span> 
            <span style="color: #008000;">&#125;</span> 
&nbsp;
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">public</span> List<span style="color: #008000;">&lt;</span>AutomationElement<span style="color: #008000;">&gt;</span> getSameXAutomationElement<span style="color: #008000;">&#40;</span>ControlType controlType<span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            List<span style="color: #008000;">&lt;</span>AutomationElement<span style="color: #008000;">&gt;</span> elements <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> List<span style="color: #008000;">&lt;</span>AutomationElement<span style="color: #008000;">&gt;</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
            List<span style="color: #008000;">&lt;</span>AutomationElement<span style="color: #008000;">&gt;</span> xelements <span style="color: #008000;">=</span> getSameXAutomationElement<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
            <span style="color: #0600FF; font-weight: bold;">foreach</span> <span style="color: #008000;">&#40;</span>AutomationElement element <span style="color: #0600FF; font-weight: bold;">in</span> xelements<span style="color: #008000;">&#41;</span> 
            <span style="color: #008000;">&#123;</span> 
                <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">!</span>element<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ControlType</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Equals</span><span style="color: #008000;">&#40;</span>controlType<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> 
                <span style="color: #008000;">&#123;</span> 
                    elements<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Add</span><span style="color: #008000;">&#40;</span>element<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
                <span style="color: #008000;">&#125;</span> 
            <span style="color: #008000;">&#125;</span> 
&nbsp;
            <span style="color: #0600FF; font-weight: bold;">return</span> elements<span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">public</span> List<span style="color: #008000;">&lt;</span>AutomationElement<span style="color: #008000;">&gt;</span> getSameYAutomationElement<span style="color: #008000;">&#40;</span>ControlType controlType<span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            List<span style="color: #008000;">&lt;</span>AutomationElement<span style="color: #008000;">&gt;</span> elements <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> List<span style="color: #008000;">&lt;</span>AutomationElement<span style="color: #008000;">&gt;</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
            List<span style="color: #008000;">&lt;</span>AutomationElement<span style="color: #008000;">&gt;</span> yelements <span style="color: #008000;">=</span> getSameYAutomationElement<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
            <span style="color: #0600FF; font-weight: bold;">foreach</span> <span style="color: #008000;">&#40;</span>AutomationElement element <span style="color: #0600FF; font-weight: bold;">in</span> yelements<span style="color: #008000;">&#41;</span> 
            <span style="color: #008000;">&#123;</span> 
                <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">!</span>element<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ControlType</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Equals</span><span style="color: #008000;">&#40;</span>controlType<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> 
                <span style="color: #008000;">&#123;</span> 
                    elements<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Add</span><span style="color: #008000;">&#40;</span>element<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
                <span style="color: #008000;">&#125;</span> 
            <span style="color: #008000;">&#125;</span> 
&nbsp;
            <span style="color: #0600FF; font-weight: bold;">return</span> elements<span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">public</span> List<span style="color: #008000;">&lt;</span>AutomationElement<span style="color: #008000;">&gt;</span> getSameXAutomationElement<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            List<span style="color: #008000;">&lt;</span>AutomationElement<span style="color: #008000;">&gt;</span> elements <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> List<span style="color: #008000;">&lt;</span>AutomationElement<span style="color: #008000;">&gt;</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
            AutomationElement window <span style="color: #008000;">=</span> getWindow<span style="color: #008000;">&#40;</span>element<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
&nbsp;
            TreeWalker tWalker <span style="color: #008000;">=</span> TreeWalker<span style="color: #008000;">.</span><span style="color: #0000FF;">ControlViewWalker</span><span style="color: #008000;">;</span> 
            AutomationElement childElement <span style="color: #008000;">=</span> tWalker<span style="color: #008000;">.</span><span style="color: #0000FF;">GetFirstChild</span><span style="color: #008000;">&#40;</span>window<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
&nbsp;
            <span style="color: #0600FF; font-weight: bold;">while</span> <span style="color: #008000;">&#40;</span>childElement <span style="color: #008000;">!=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">&#41;</span> 
            <span style="color: #008000;">&#123;</span> 
                <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>childElement <span style="color: #008000;">!=</span> element <span style="color: #008000;">&amp;&amp;</span> Math<span style="color: #008000;">.</span><span style="color: #0000FF;">Abs</span><span style="color: #008000;">&#40;</span>childElement<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">BoundingRectangle</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Top</span> <span style="color: #008000;">-</span> element<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">BoundingRectangle</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Top</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&lt;</span> <span style="color: #FF0000;">5</span><span style="color: #008000;">&#41;</span> 
                <span style="color: #008000;">&#123;</span> 
                    elements<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Add</span><span style="color: #008000;">&#40;</span>childElement<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
                <span style="color: #008000;">&#125;</span> 
                childElement <span style="color: #008000;">=</span> tWalker<span style="color: #008000;">.</span><span style="color: #0000FF;">GetNextSibling</span><span style="color: #008000;">&#40;</span>childElement<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
            <span style="color: #008000;">&#125;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> elements<span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
&nbsp;
        <span style="color: #0600FF; font-weight: bold;">public</span> List<span style="color: #008000;">&lt;</span>AutomationElement<span style="color: #008000;">&gt;</span> getSameYAutomationElement<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> 
        <span style="color: #008000;">&#123;</span> 
            List<span style="color: #008000;">&lt;</span>AutomationElement<span style="color: #008000;">&gt;</span> elements <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> List<span style="color: #008000;">&lt;</span>AutomationElement<span style="color: #008000;">&gt;</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
            AutomationElement window <span style="color: #008000;">=</span> getWindow<span style="color: #008000;">&#40;</span>element<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
&nbsp;
            TreeWalker tWalker <span style="color: #008000;">=</span> TreeWalker<span style="color: #008000;">.</span><span style="color: #0000FF;">ControlViewWalker</span><span style="color: #008000;">;</span> 
            AutomationElement childElement <span style="color: #008000;">=</span> tWalker<span style="color: #008000;">.</span><span style="color: #0000FF;">GetFirstChild</span><span style="color: #008000;">&#40;</span>window<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
&nbsp;
            <span style="color: #0600FF; font-weight: bold;">while</span> <span style="color: #008000;">&#40;</span>childElement <span style="color: #008000;">!=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">&#41;</span> 
            <span style="color: #008000;">&#123;</span> 
                <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>childElement <span style="color: #008000;">!=</span> element <span style="color: #008000;">&amp;&amp;</span> Math<span style="color: #008000;">.</span><span style="color: #0000FF;">Abs</span><span style="color: #008000;">&#40;</span>childElement<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">BoundingRectangle</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Left</span> <span style="color: #008000;">-</span> element<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">BoundingRectangle</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Left</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&lt;</span> <span style="color: #FF0000;">5</span><span style="color: #008000;">&#41;</span> 
                <span style="color: #008000;">&#123;</span> 
                    elements<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Add</span><span style="color: #008000;">&#40;</span>childElement<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
                <span style="color: #008000;">&#125;</span> 
                childElement <span style="color: #008000;">=</span> tWalker<span style="color: #008000;">.</span><span style="color: #0000FF;">GetNextSibling</span><span style="color: #008000;">&#40;</span>childElement<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
            <span style="color: #008000;">&#125;</span> 
            <span style="color: #0600FF; font-weight: bold;">return</span> elements<span style="color: #008000;">;</span> 
        <span style="color: #008000;">&#125;</span> 
    <span style="color: #008000;">&#125;</span></pre></div></div>


<div class="wp_code"><div class="pre"><pre class="csharp" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #6666cc; font-weight: bold;">enum</span> LocationDirection
<span style="color: #008000;">&#123;</span>
    LEFT <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span>,
    RIGHT <span style="color: #008000;">=</span> <span style="color: #FF0000;">1</span>,
    UP <span style="color: #008000;">=</span> <span style="color: #FF0000;">2</span>,
    DOWN <span style="color: #008000;">=</span> <span style="color: #FF0000;">3</span>
<span style="color: #008000;">&#125;</span></pre></div></div>

]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/9487.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>UI Automation对象识别方式</title>
		<link>http://www.xieziming.com/archives/9468.html</link>
		<comments>http://www.xieziming.com/archives/9468.html#respond</comments>
		<pubDate>Thu, 07 May 2015 07:03:48 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[Automation]]></category>
		<category><![CDATA[UI Automation]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=9468</guid>
		<description><![CDATA[UI Automation中查询子元素有两种方式，一种是通过TreeWalker类的GetFirstChild和GetLastChild方法。一种是通过AutomationElement类的FindFirst和FirstAll方法。

在UIA中，程序UI的每一个部分都被认为是一个AutomationElement类，他们是一个树状的结构，Desktop被认为是每个windows based app的UIA树状图的根，从类的定义中，我们也可以看到一个AutomationElement类中有一个static的RootElement属性。

<strong>对象识别：</strong>

<code lang="csharp">
AutomationnElement desktop = AutomationElement.RootElement;
PropertyCondition typeCond = new PropertyCondition(AutomationElement.ControlTypeProperty, ControlType.Window);
PropertyCondition nameCond = new PropertyCondition(AutomationElement.NameProperty, "Trader Desktop");
AutomationElement traderDesktop = desktop.findFirst(TreeScope.Children, new AndCondition(nameCond, typeCond));
AutomationElementCollection traderDesktops = desktop.findAll(TreeScope.Children, new AndCondition(nameCond, typeCond));
</code>]]></description>
				<content:encoded><![CDATA[<p>UI Automation中查询子元素有两种方式，一种是通过TreeWalker类的GetFirstChild和GetLastChild方法。一种是通过AutomationElement类的FindFirst和FirstAll方法。</p>
<p>在UIA中，程序UI的每一个部分都被认为是一个AutomationElement类，他们是一个树状的结构，Desktop被认为是每个windows based app的UIA树状图的根，从类的定义中，我们也可以看到一个AutomationElement类中有一个static的RootElement属性。</p>
<p><strong>对象识别：</strong></p>

<div class="wp_code"><div class="pre"><pre class="csharp" style="font-family:'Times New Roman',Garamond, Times;">AutomationnElement desktop <span style="color: #008000;">=</span> AutomationElement<span style="color: #008000;">.</span><span style="color: #0000FF;">RootElement</span><span style="color: #008000;">;</span>
PropertyCondition typeCond <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> PropertyCondition<span style="color: #008000;">&#40;</span>AutomationElement<span style="color: #008000;">.</span><span style="color: #0000FF;">ControlTypeProperty</span>, ControlType<span style="color: #008000;">.</span><span style="color: #0000FF;">Window</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
PropertyCondition nameCond <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> PropertyCondition<span style="color: #008000;">&#40;</span>AutomationElement<span style="color: #008000;">.</span><span style="color: #0000FF;">NameProperty</span>, <span style="color: #666666;">&quot;Trader Desktop&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
AutomationElement traderDesktop <span style="color: #008000;">=</span> desktop<span style="color: #008000;">.</span><span style="color: #0000FF;">findFirst</span><span style="color: #008000;">&#40;</span>TreeScope<span style="color: #008000;">.</span><span style="color: #0000FF;">Children</span>, <span style="color: #008000;">new</span> AndCondition<span style="color: #008000;">&#40;</span>nameCond, typeCond<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
AutomationElementCollection traderDesktops <span style="color: #008000;">=</span> desktop<span style="color: #008000;">.</span><span style="color: #0000FF;">findAll</span><span style="color: #008000;">&#40;</span>TreeScope<span style="color: #008000;">.</span><span style="color: #0000FF;">Children</span>, <span style="color: #008000;">new</span> AndCondition<span style="color: #008000;">&#40;</span>nameCond, typeCond<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span></pre></div></div>

<p><strong>对象遍历：</strong></p>
<blockquote><p>
<strong>ContentViewWalker</strong><br />
表示一个预定义的 TreeWalker，其中包含目录树中标记为内容控件的元素的视图。Content View则是Control View的一个子集，它只包含能和用户直接交互真实信息的控件，比如接受键盘输入的Textbox，选择不同值的Combobox；而诸如lable等控件则不会包含在其中</p>
<p><strong>ControlViewWalker</strong><br />
表示一个预定义的 TreeWalker，其中包含目录树中标记为控件的元素的视图。Control View是Raw View的子集，它最贴近于最终用户所能感知的UI结构，但是它不包含不能和用户相互交互的一些UI，例如listview的header，toolbar等等。</p>
<p><strong>RawViewWalker</strong><br />
表示一个预定义的 TreeWalker，其中包含目录树中所有元素的视图。Raw View提供的信息最多，也是其他view的基础，最贴近于程序本身的编程结构。
</p></blockquote>

<div class="wp_code"><div class="pre"><pre class="csharp" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> WalkControlElements<span style="color: #008000;">&#40;</span>AutomationElement rootElement, TreeNode treeNode<span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span> 
     <span style="color: #008080; font-style: italic;">//TreeWalker.ControlViewWalker, TreeWalker.ContentViewWalker, TreeWalker.RawViewWalker</span>
     AutomationElement elementNode <span style="color: #008000;">=</span> TreeWalker<span style="color: #008000;">.</span><span style="color: #0000FF;">ControlViewWalker</span><span style="color: #008000;">.</span><span style="color: #0000FF;">GetFirstChild</span><span style="color: #008000;">&#40;</span>rootElement<span style="color: #008000;">&#41;</span>
     <span style="color: #0600FF; font-weight: bold;">while</span> <span style="color: #008000;">&#40;</span>elementNode <span style="color: #008000;">!=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span> 
        TreeNode childTreeNode <span style="color: #008000;">=</span> treeNode<span style="color: #008000;">.</span><span style="color: #0000FF;">Nodes</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Add</span><span style="color: #008000;">&#40;</span>elementNode<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ControlType</span><span style="color: #008000;">.</span><span style="color: #0000FF;">LocalizedControlType</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
        WalkControlElements<span style="color: #008000;">&#40;</span>elementNode, childTreeNode<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
        elementNode <span style="color: #008000;">=</span> TreeWalker<span style="color: #008000;">.</span><span style="color: #0000FF;">ControlViewWalker</span><span style="color: #008000;">.</span><span style="color: #0000FF;">GetNextSibling</span><span style="color: #008000;">&#40;</span>elementNode<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> 
     <span style="color: #008000;">&#125;</span> 
<span style="color: #008000;">&#125;</span></pre></div></div>

<p>为什么有了微软给出的对象识别（过滤）方式，我们还要自己做对象的遍历：</p>
<blockquote><p>
微软给出的对象识别（过滤）主要就是利用TreeWalker.ControlViewWalker来遍历所有的标准控件，然后根据过滤条件来筛选。但对于那些非标准控件，一开始就被排除了，这个时候我们就需要使用RawViewWalker.
</p></blockquote>
<p>两者之间还是有性能上的区别，在MSDN的TreeWalker类说明中有这么一段话描述：“使用 TreeWalker 在 UI 自动化目录树中导航可能导致进程间调用，并且其效率不如使用 FindAll 或 FindFirst 方法来定位元素”。有效率上的区别，这点很关键，要知道在一个元素非常多的被测试应用程序上，有很大一部分的工作就在于定位元素，即查找元素，如果测试用例有成百上千条的时候，这两种查找元素的方式有一点效率上的差异，通过大数量级的测试用例运行后的累积效应，其测试所用总时间也会差异较大。</p>
]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/9468.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>微软UI Automation</title>
		<link>http://www.xieziming.com/archives/9480.html</link>
		<comments>http://www.xieziming.com/archives/9480.html#respond</comments>
		<pubDate>Tue, 07 Apr 2015 08:28:16 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[Automation]]></category>
		<category><![CDATA[UI Automation]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=9480</guid>
		<description><![CDATA[MS UI Automation（Microsoft User Interface Automation：UIA）随.NET Framework一起发布。 什么是MS UI Automation： MS UI Automation是MSAA技术的一个替代品：即让控件和应用程序具有更好的可达性（accessible），它就是几个dll，提供了一套API和Interface及其相应的模式，让软件的开发者遵循该模式去实现相应的interface，从而软件的使用者（不仅仅是客户，还包括例如测试人员想编写一些自动化测试代码来完成程序相关的业务逻辑）能更好的使用该软件。 和原来的MSAA相比较：UIA重新设计了一套架构，无论是对传统的winform，还是新的wpf，定义了一套统一的模型；其API的使用也相对更简单；同时，和.NET Framework一起，也有inspect.exe和UIA Verify的工具来辅助大家来使用UIA。 UIA之架构 MS UIA明确定义了两个role： （1）UIA Provider即软件本身，主要是软件的开发人员依据相应的模式去实现相关的interface。对于标准控件而言，默认是支持UIA的，而对于自定义的控件，需要实现该控件的行为对应于UIA所定义的interface。 （2）UIA Client即自动化脚本和相关的assistive technology applications，从测试人员的角度出发，主要是调用相应的API去实现自动化测试脚本 UIA主要有4个DLL： （1）UIAutomationProvider.dll，定义了各种行为的interface，例如，假设有个自定义的控件，开发人员觉得它需要支持Dock行为，就需要实现IDockProvider接口。 （2）UIAutomaitonClient.dll，定义了各种控件模式，以及一些用来支持更好的定位控件的辅助条件搜索类。 （3）UIAutomationCore.dll则是用来支持UIA provider和client之间的通信的。 （4）UIAutomationClientssideProviders.dll则主要是用来支持传统的winform的标准控件的。]]></description>
				<content:encoded><![CDATA[<p>MS UI Automation（Microsoft User Interface Automation：UIA）随.NET Framework一起发布。</p>
<p><strong>什么是MS UI Automation：</strong></p>
<blockquote><p>
MS UI Automation是MSAA技术的一个替代品：即让控件和应用程序具有更好的可达性（accessible），它就是几个dll，提供了一套API和Interface及其相应的模式，让软件的开发者遵循该模式去实现相应的interface，从而软件的使用者（不仅仅是客户，还包括例如测试人员想编写一些自动化测试代码来完成程序相关的业务逻辑）能更好的使用该软件。
</p></blockquote>
<p>和原来的MSAA相比较：UIA重新设计了一套架构，无论是对传统的winform，还是新的wpf，定义了一套统一的模型；其API的使用也相对更简单；同时，和.NET Framework一起，也有inspect.exe和UIA Verify的工具来辅助大家来使用UIA。</p>
<p><strong>UIA之架构</strong></p>
<p>MS UIA明确定义了两个role：</p>
<blockquote><p>
（1）UIA Provider即软件本身，主要是软件的开发人员依据相应的模式去实现相关的interface。对于标准控件而言，默认是支持UIA的，而对于自定义的控件，需要实现该控件的行为对应于UIA所定义的interface。</p>
<p>（2）UIA Client即自动化脚本和相关的assistive technology applications，从测试人员的角度出发，主要是调用相应的API去实现自动化测试脚本
</p></blockquote>
<p>UIA主要有4个DLL：</p>
<blockquote><p>
（1）UIAutomationProvider.dll，定义了各种行为的interface，例如，假设有个自定义的控件，开发人员觉得它需要支持Dock行为，就需要实现IDockProvider接口。</p>
<p>（2）UIAutomaitonClient.dll，定义了各种控件模式，以及一些用来支持更好的定位控件的辅助条件搜索类。</p>
<p>（3）UIAutomationCore.dll则是用来支持UIA provider和client之间的通信的。</p>
<p>（4）UIAutomationClientssideProviders.dll则主要是用来支持传统的winform的标准控件的。
</p></blockquote>
]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/9480.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Jemmy入门之Waiter</title>
		<link>http://www.xieziming.com/archives/8630.html</link>
		<comments>http://www.xieziming.com/archives/8630.html#respond</comments>
		<pubDate>Wed, 10 Apr 2013 08:23:38 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[Automation]]></category>
		<category><![CDATA[Jemmy]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=8630</guid>
		<description><![CDATA[Jemmy中Waiter主要用于等待某个动作做完或者等待某个对象出现。在规定时间没做完的话会抛出超时异常。
<code lang="java">
/**
 * 可以看到它实现了Waitable, Timeoutable, Outputable这三个接口
 * 不过不是很明白它为啥要实现Waitable
 */
public class Waiter implements Waitable, Timeoutable, Outputable {
	/**
	 * timeout 常量，其中WAIT_TIME一般后来会被覆盖
	 */
	private final static long TIME_DELTA = 10;
	private final static long WAIT_TIME = 60000;
	private final static long AFTER_WAIT_TIME = 0;

	private Waitable waitable;
	private long startTime = 0;
	private long endTime = -1;
	private Object result;
	private Timeouts timeouts;
	private String waitingTimeOrigin;
	private TestOut out;
</code>]]></description>
				<content:encoded><![CDATA[<p>Jemmy中Waiter主要用于等待某个动作做完或者等待某个对象出现。在规定时间没做完的话会抛出超时异常。</p>

<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #008000; font-style: italic; font-weight: bold;">/**
 * 可以看到它实现了Waitable, Timeoutable, Outputable这三个接口
 * 不过不是很明白它为啥要实现Waitable
 */</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> Waiter <span style="color: #000000; font-weight: bold;">implements</span> Waitable, Timeoutable, Outputable <span style="color: #009900;">&#123;</span>
	<span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 * timeout 常量，其中WAIT_TIME一般后来会被覆盖
	 */</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">long</span> TIME_DELTA <span style="color: #339933;">=</span> <span style="color: #cc66cc;">10</span><span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">long</span> WAIT_TIME <span style="color: #339933;">=</span> <span style="color: #cc66cc;">60000</span><span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">long</span> AFTER_WAIT_TIME <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">private</span> Waitable waitable<span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000066; font-weight: bold;">long</span> startTime <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000066; font-weight: bold;">long</span> endTime <span style="color: #339933;">=</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #003399;">Object</span> result<span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">private</span> Timeouts timeouts<span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #003399;">String</span> waitingTimeOrigin<span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">private</span> TestOut out<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 * Constructor.
	 * 
	 * @param w
	 *            Waitable object defining waiting criteria.
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> Waiter<span style="color: #009900;">&#40;</span>Waitable w<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">super</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		setTimeouts<span style="color: #009900;">&#40;</span>JemmyProperties.<span style="color: #006633;">getProperties</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getTimeouts</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		setOutput<span style="color: #009900;">&#40;</span>JemmyProperties.<span style="color: #006633;">getProperties</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getOutput</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		waitable <span style="color: #339933;">=</span> w<span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
       <span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 * 初始化Waiter的timeout常量
	 */</span>
	<span style="color: #000000; font-weight: bold;">static</span> <span style="color: #009900;">&#123;</span>
		Timeouts.<span style="color: #006633;">initDefault</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Waiter.TimeDelta&quot;</span>, TIME_DELTA<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		Timeouts.<span style="color: #006633;">initDefault</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Waiter.WaitingTime&quot;</span>, WAIT_TIME<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		Timeouts.<span style="color: #006633;">initDefault</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Waiter.AfterWaitingTime&quot;</span>, AFTER_WAIT_TIME<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 * 这个函数经常用于改写Waiter.WaitingTime，以实现自定义的等待时间
	 * @param timeouts
	 * 传入的timeouts，一般都包含了一些在其他类的静态初始化了的timeout，比如从
         * ComponentOperator传入的话一般会包含WAIT_COMPONENT_TIMEOUT这个timeout
	 * @param useAsWaitingTime
	 * 用来覆盖&quot;Waiter.WaitingTime&quot;的timeout，比如ComponentOperator.WaitComponentTimeout.
	 * @return the cloned timeouts.
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> Timeouts setTimeoutsToCloneOf<span style="color: #009900;">&#40;</span>Timeouts timeouts,	<span style="color: #003399;">String</span> useAsWaitingTime<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		Timeouts t <span style="color: #339933;">=</span> timeouts.<span style="color: #006633;">cloneThis</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		t.<span style="color: #006633;">setTimeout</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Waiter.WaitingTime&quot;</span>, t.<span style="color: #006633;">getTimeout</span><span style="color: #009900;">&#40;</span>useAsWaitingTime<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		setTimeouts<span style="color: #009900;">&#40;</span>t<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">return</span> t<span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 * Waits for not null result of actionProduced method of Waitable
	 * implementation passed into constructor.
	 * 
	 * @param waitableObject
	 *            Object to be passed into actionProduced method.
	 * @return non null result of action.
	 * @throws TimeoutExpiredException
	 * @exception InterruptedException
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">Object</span> waitAction<span style="color: #009900;">&#40;</span><span style="color: #003399;">Object</span> waitableObject<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">InterruptedException</span> <span style="color: #009900;">&#123;</span>
                startTime <span style="color: #339933;">=</span> <span style="color: #003399;">System</span>.<span style="color: #006633;">currentTimeMillis</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">long</span> timeDelta <span style="color: #339933;">=</span> timeouts.<span style="color: #006633;">getTimeout</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Waiter.TimeDelta&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>result <span style="color: #339933;">=</span> checkActionProduced<span style="color: #009900;">&#40;</span>waitableObject<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
                      <span style="color: #008000; font-style: italic; font-weight: bold;">/**
                        * 每隔多少毫秒检查一次动作是否完成
                        */</span>
			<span style="color: #003399;">Thread</span>.<span style="color: #006633;">currentThread</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">sleep</span><span style="color: #009900;">&#40;</span>timeDelta<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                      <span style="color: #008000; font-style: italic; font-weight: bold;">/**
                        * 超时检查
                        */</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>timeoutExpired<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> TimeoutExpiredException<span style="color: #009900;">&#40;</span>getActualDescription<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
		endTime <span style="color: #339933;">=</span> <span style="color: #003399;">System</span>.<span style="color: #006633;">currentTimeMillis</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Thread</span>.<span style="color: #006633;">currentThread</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">sleep</span><span style="color: #009900;">&#40;</span>timeouts.<span style="color: #006633;">getTimeout</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Waiter.AfterWaitingTime&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">return</span> <span style="color: #009900;">&#40;</span>result<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
        <span style="color: #008000; font-style: italic; font-weight: bold;">/**
         * 检查动作是否完成，所以需要等待的动作必须实现Waitable的actionProduced方法。
         */</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #003399;">Object</span> checkActionProduced<span style="color: #009900;">&#40;</span><span style="color: #003399;">Object</span> obj<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>waitable <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">return</span> <span style="color: #009900;">&#40;</span>waitable.<span style="color: #006633;">actionProduced</span><span style="color: #009900;">&#40;</span>obj<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">return</span> <span style="color: #009900;">&#40;</span>actionProduced<span style="color: #009900;">&#40;</span>obj<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
       <span style="color: #008000; font-style: italic; font-weight: bold;">/**
         * 检查是否超时。
         */</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000066; font-weight: bold;">boolean</span> timeoutExpired<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">return</span> <span style="color: #009900;">&#40;</span>timeFromStart<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> timeouts.<span style="color: #006633;">getTimeout</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Waiter.WaitingTime&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
        <span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000066; font-weight: bold;">long</span> timeFromStart<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">return</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">System</span>.<span style="color: #006633;">currentTimeMillis</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">-</span> startTime<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre></div></div>

]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/8630.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Jemmy入门之接口</title>
		<link>http://www.xieziming.com/archives/8626.html</link>
		<comments>http://www.xieziming.com/archives/8626.html#respond</comments>
		<pubDate>Sat, 30 Mar 2013 03:09:05 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[Automation]]></category>
		<category><![CDATA[Jemmy]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=8626</guid>
		<description><![CDATA[Jemmy里定义了很多的接口，比如做一个动作的时候（ActionProducer）会实现Action, Waitable,Timeoutable这三个接口。
<code lang="java">
public interface Waitable{
    /**
     * Checks if wait criteria have been met.
     * @param obj optional waiting parameter.
     * @return null is criteria have not been met.
     */
    public Object actionProduced(Object obj);

    /**
     * Returns description.
     * @return a description of the wait criteria.
     */
    public String getDescription();
}
</code>

<code lang="java">
public interface Timeoutable {
    /**
     * Defines current timeouts.
     * @param t A collection of timeout assignments.
     * @see #getTimeouts
     */
    public void setTimeouts(Timeouts t);

    /**
     * Return current timeouts.
     * @return the collection of current timeout assignments.
     * @see #setTimeouts
     */
    public Timeouts getTimeouts();
}
</code>]]></description>
				<content:encoded><![CDATA[<p>Jemmy里定义了很多的接口，比如做一个动作的时候（ActionProducer）会实现Action, Waitable,Timeoutable这三个接口。</p>

<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">interface</span> Waitable<span style="color: #009900;">&#123;</span>
    <span style="color: #008000; font-style: italic; font-weight: bold;">/**
     * Checks if wait criteria have been met.
     * @param obj optional waiting parameter.
     * @return null is criteria have not been met.
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">Object</span> actionProduced<span style="color: #009900;">&#40;</span><span style="color: #003399;">Object</span> obj<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/**
     * Returns description.
     * @return a description of the wait criteria.
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">String</span> getDescription<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></div>


<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">interface</span> Timeoutable <span style="color: #009900;">&#123;</span>
    <span style="color: #008000; font-style: italic; font-weight: bold;">/**
     * Defines current timeouts.
     * @param t A collection of timeout assignments.
     * @see #getTimeouts
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setTimeouts<span style="color: #009900;">&#40;</span>Timeouts t<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/**
     * Return current timeouts.
     * @return the collection of current timeout assignments.
     * @see #setTimeouts
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> Timeouts getTimeouts<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></div>


<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">interface</span> Outputable <span style="color: #009900;">&#123;</span>
    <span style="color: #008000; font-style: italic; font-weight: bold;">/**
     * Defines print output streams or writers.
     * @param out Identify the streams or writers used for print output.
     * @see #getOutput
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setOutput<span style="color: #009900;">&#40;</span>TestOut out<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/**
     * Returns print output streams or writers.
     * @return an object that contains references to objects for
     * printing to output and err streams.
     * @see #setOutput
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> TestOut getOutput<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></div>


<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">interface</span> <span style="color: #003399;">Action</span><span style="color: #009900;">&#123;</span>
    <span style="color: #008000; font-style: italic; font-weight: bold;">/**
     * Executes this action.
     * @param obj action argument. This argument might be the method
     * parameter in an invocation of
     * ActionProducer.produceAction(Object).  This argument
     * might be a java.lang.String[] that lists the
     * command line arguments used to execute a test (or not).
     * @return action result.
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">Object</span> launch<span style="color: #009900;">&#40;</span><span style="color: #003399;">Object</span> obj<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/**
     * Returns the description value.
     * @return Action description.
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">String</span> getDescription<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></div>


<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">interface</span> Scenario <span style="color: #009900;">&#123;</span>
    <span style="color: #008000; font-style: italic; font-weight: bold;">/**
     * Defines a way to execute this test scenario.
     * @param param An object passed to configure the test scenario
     * execution.  For example, this parameter might be a
     * &lt;code&gt;java.lang.String[]&lt;code&gt; object that lists the
     * command line arguments to the Java application corresponding
     * to a test.
     * @return an int that tells something about the execution.
     * For, example, a status code.
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">int</span> runIt<span style="color: #009900;">&#40;</span><span style="color: #003399;">Object</span> param<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></div>

]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/8626.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Jemmy入门之ActionProducer</title>
		<link>http://www.xieziming.com/archives/8636.html</link>
		<comments>http://www.xieziming.com/archives/8636.html#respond</comments>
		<pubDate>Sun, 10 Mar 2013 09:02:07 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[Automation]]></category>
		<category><![CDATA[Jemmy]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=8636</guid>
		<description><![CDATA[ActionProducer是Scenario的基类，主要是执行一个在预期时间内要完成的动作。
<code lang="java">
public class ActionProducer extends Thread implements Action, Waitable,	Timeoutable {
	/**
	 * timeout 常量，一般用来覆盖Waiter的WAIT_TIME
	 */
	private final static long ACTION_TIMEOUT = 10000;

	private Action action;
	private boolean needWait = true;
	private Object parameter;
	private boolean finished;
	private Object result = null;
	private Timeouts timeouts;
	private Waiter waiter;
	private TestOut output;
	private Throwable exception;
</code>]]></description>
				<content:encoded><![CDATA[<p>ActionProducer是Scenario的基类，主要是执行一个在预期时间内要完成的动作。</p>

<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> ActionProducer <span style="color: #000000; font-weight: bold;">extends</span> <span style="color: #003399;">Thread</span> <span style="color: #000000; font-weight: bold;">implements</span> <span style="color: #003399;">Action</span>, Waitable,	Timeoutable <span style="color: #009900;">&#123;</span>
	<span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 * timeout 常量，一般用来覆盖Waiter的WAIT_TIME
	 */</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">long</span> ACTION_TIMEOUT <span style="color: #339933;">=</span> <span style="color: #cc66cc;">10000</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #003399;">Action</span> action<span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000066; font-weight: bold;">boolean</span> needWait <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">true</span><span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #003399;">Object</span> parameter<span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000066; font-weight: bold;">boolean</span> finished<span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #003399;">Object</span> result <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">private</span> Timeouts timeouts<span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">private</span> Waiter waiter<span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">private</span> TestOut output<span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #003399;">Throwable</span> exception<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 * Creates a producer for an action.
	 * 
	 * @param a
	 *            Action implementation.
	 * @param nw
	 *            Defines if produceAction method should wait for
	 *            the end of action.
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> ActionProducer<span style="color: #009900;">&#40;</span><span style="color: #003399;">Action</span> a, <span style="color: #000066; font-weight: bold;">boolean</span> nw<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">super</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		waiter <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Waiter<span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		action <span style="color: #339933;">=</span> a<span style="color: #339933;">;</span>
		needWait <span style="color: #339933;">=</span> nw<span style="color: #339933;">;</span>
		setTimeouts<span style="color: #009900;">&#40;</span>JemmyProperties.<span style="color: #006633;">getProperties</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getTimeouts</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		setOutput<span style="color: #009900;">&#40;</span>JemmyProperties.<span style="color: #006633;">getProperties</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getOutput</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		finished <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">false</span><span style="color: #339933;">;</span>
		exception <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
        <span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 * 初始化Waiter的timeout常量
	 */</span>
	<span style="color: #000000; font-weight: bold;">static</span> <span style="color: #009900;">&#123;</span>
		Timeouts.<span style="color: #006633;">initDefault</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;ActionProducer.MaxActionTime&quot;</span>, ACTION_TIMEOUT<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 * Starts execution. Uses ActionProducer.MaxActionTime timeout.
	 * 
	 * @param obj
	 *            Parameter to be passed into action's
	 *            launch(Object) method. This parameter might be a
	 *            java.lang.String[] that lists a test's command
	 *            line arguments.
	 * @param actionTimeOrigin
	 *            is used for timeout reporting, if non-null.
	 * @return launch(Object) result.
	 * @throws TimeoutExpiredException
	 * @exception InterruptedException
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">Object</span> produceAction<span style="color: #009900;">&#40;</span><span style="color: #003399;">Object</span> obj, <span style="color: #003399;">String</span> actionTimeOrigin<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">InterruptedException</span> <span style="color: #009900;">&#123;</span>
		parameter <span style="color: #339933;">=</span> obj<span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">synchronized</span> <span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			finished <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">false</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
		start<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><span style="color: #666666; font-style: italic;">//thread started, run mothod kick off</span>
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>needWait<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			waiter.<span style="color: #006633;">setTimeoutsToCloneOf</span><span style="color: #009900;">&#40;</span>timeouts,<span style="color: #0000ff;">&quot;ActionProducer.MaxActionTime&quot;</span>, actionTimeOrigin<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
				waiter.<span style="color: #006633;">waitAction</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span>TimeoutExpiredException e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				interrupt<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">return</span> <span style="color: #009900;">&#40;</span>result<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
        <span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 * 在produceAction中的start函数调用后开始，在单独的线程
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #000066; font-weight: bold;">void</span> run<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		result <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
			result <span style="color: #339933;">=</span> launchAction<span style="color: #009900;">&#40;</span>parameter<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Throwable</span> e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			exception <span style="color: #339933;">=</span> e<span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">synchronized</span> <span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			finished <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">true</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
        <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #003399;">Object</span> launchAction<span style="color: #009900;">&#40;</span><span style="color: #003399;">Object</span> obj<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>action <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">return</span> <span style="color: #009900;">&#40;</span>action.<span style="color: #006633;">launch</span><span style="color: #009900;">&#40;</span>obj<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">return</span> <span style="color: #009900;">&#40;</span>launch<span style="color: #009900;">&#40;</span>obj<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 * 实现Waitable接口
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">Object</span> actionProduced<span style="color: #009900;">&#40;</span><span style="color: #003399;">Object</span> obj<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">synchronized</span> <span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>finished<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>result <span style="color: #339933;">==</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
					<span style="color: #000000; font-weight: bold;">return</span> <span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">Integer</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
					<span style="color: #000000; font-weight: bold;">return</span> <span style="color: #009900;">&#40;</span>result<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #009900;">&#125;</span>
			<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #000000; font-weight: bold;">return</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre></div></div>

]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/8636.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>当我们谈论自动化测试</title>
		<link>http://www.xieziming.com/archives/7801.html</link>
		<comments>http://www.xieziming.com/archives/7801.html#respond</comments>
		<pubDate>Fri, 21 Dec 2012 13:04:18 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[Automation]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=7801</guid>
		<description><![CDATA[Cockburn在《敏捷软件开发》中提到“沟通的成功依赖于发送者和接收者有可以引用的共同体验”，因此当我们提到自动化测试时，就一定需要有共同的词汇表。首先，什么是自动化测试？<strong>对一些人来说，一提到自动化测试，第一个闪过脑海的念头就是QTP、WebDriver等自动化测试工具，以及依据这些工具建立的针对功能或是UI的自动化测试测试脚本，但其实这些只是自动化测试中的一小部分而已，在我看来，所有“使用机器的能力”对测试进行部分或全部自动化的操作都应该被叫做“自动化测试”。无论是针对代码中的类或是方法建立的单元测试，还是针对产品建立的需要人工参与的diff的方式，都是自动化测试的具体方法。</strong>对测试来说，自动化测试不是一个存在的目标，而仅仅是一种用以达成测试目标的手段。我们希望从自动化测试中得到什么？自动化测试覆盖率？自动化测试覆盖率是用来衡量自动化测试所占比例的一种手段，但这仍然不是我们在项目中开展自动化测试的目标。我们在项目中开展自动化测试，目标只能是“通过自动化测试提高测试或是产品的质量”。因此，在谈论自动化测试时，可以被称为目标的，只能是下面这几项：

（1）在保证相同的测试覆盖率的情况下，减少人力资源的投入;
（2）在相同人力资源投入的情况下，增加了测试覆盖率;
（3）让测试的执行向上游移动，帮助开发者更早的发现产品中的问题，从而降低修复成本。]]></description>
				<content:encoded><![CDATA[<p>Cockburn在《敏捷软件开发》中提到“沟通的成功依赖于发送者和接收者有可以引用的共同体验”，因此当我们提到自动化测试时，就一定需要有共同的词汇表。首先，什么是自动化测试？</p>
<p><strong>对一些人来说，一提到自动化测试，第一个闪过脑海的念头就是QTP、WebDriver等自动化测试工具，以及依据这些工具建立的针对功能或是UI的自动化测试测试脚本，但其实这些只是自动化测试中的一小部分而已，在我看来，所有“使用机器的能力”对测试进行部分或全部自动化的操作都应该被叫做“自动化测试”。无论是针对代码中的类或是方法建立的单元测试，还是针对产品建立的需要人工参与的diff的方式，都是自动化测试的具体方法。</strong></p>
<p>对测试来说，自动化测试不是一个存在的目标，而仅仅是一种用以达成测试目标的手段。我们希望从自动化测试中得到什么？自动化测试覆盖率？自动化测试覆盖率是用来衡量自动化测试所占比例的一种手段，但这仍然不是我们在项目中开展自动化测试的目标。我们在项目中开展自动化测试，目标只能是“通过自动化测试提高测试或是产品的质量”。因此，在谈论自动化测试时，可以被称为目标的，只能是下面这几项：</p>
<p>（1）在保证相同的测试覆盖率的情况下，减少人力资源的投入;<br />
（2）在相同人力资源投入的情况下，增加了测试覆盖率;<br />
（3）让测试的执行向上游移动，帮助开发者更早的发现产品中的问题，从而降低修复成本。</p>
<p>有了目标，剩下来的就是怎么做的问题。“减少人力资源的投入”是一个最容易被直观理解的自动化测试目标，因此，不少团队的做法就是“用自动化测试替代手工测试”，将原先需要手工执行的测试用例变成UI自动化测试用例，改由自动化测试工具来执行脚本。<strong>不能说，这种方式没有效果，但由于自动化测试在识别缺陷方面的有效性远远低于手工测试（从UI测试的角度来说，一个非“预期”产生的缺陷很难被自动化测试发现，而手工测试则能轻松的发现这个缺陷），而且由于UI本身的变化性，要想达到和手工测试相同的覆盖率，单纯的UI自动化测试往往很难证明自己的投资回报。</strong></p>
<p>“增加测试覆盖率”是自动化测试可以产生收益的另一个方面。容易想到的例子是性能测试和模糊测试（Fuzz testing）。依靠机器的能力，模拟大量用户的并发，以及依靠机器的能力，<strong>基于规则产生大量随机数据并发送给服务器，用于检测服务器可能的安全性问题</strong>，在这些领域，自动化测试能带来明显的收益。但，当我说到“增加测试覆盖率”时，我所想要谈论的<strong>不仅仅</strong>是性能测试或是模糊测试这一类的针对应用某个质量属性的验证。</p>
]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/7801.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>软件测试理念（三）</title>
		<link>http://www.xieziming.com/archives/7808.html</link>
		<comments>http://www.xieziming.com/archives/7808.html#respond</comments>
		<pubDate>Wed, 28 Nov 2012 14:01:10 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=7808</guid>
		<description><![CDATA[Q: 如何做一名优秀的软件测试工程师？他至少具备哪些技术能力？

A: 软件测试工程师首先是一个软件工程师，也就是说他必须具备软件工程师的基本技术能力，比如对计算机结构系统（硬件，操作系统，内存，网络等）基本了解，再有就是算法数据结构，以及开发编程能力，最后就是对所工作领域的技术掌握。有了这些基本技术后，下面要掌握一些测试技术，比如黑盒白盒、等价类、边界值、功能测试、性能压力测试和安全性测试等。除了必须懂得技术硬技能外，要想成为一名优秀的软件测试工程师还必须有很强的软技能，这包括对产品质量的热情和沟通协调能力等。其中对产品质量的热情和专注尤为重要，因为兴趣是最好的老师，只有对所做的工作充满热情，你才会从平庸变成卓越。

Q: 怎么才能进行有效地探索性测试？另外很多优秀的软件测试工程师都能敏锐地嗅到bug，你认为如何训练这方面能力？</strong>

A: 探索性测试不仅需要对产品熟悉，还需要掌握开发产品采用的技术，最后就是自己经验的积累，这三者缺少一个都很容易把探索性测试变成漫无目的的测试。因为探索性测试是边运行测试、边了解产品和边设计新的测试。它根据当前测试步骤产生的结果，加以分析判断，然后使用策略决定下一步会最有可能发现产品中的bug。我曾写过一篇介绍探索性测试的文章，那里面用猜数字的游戏来解释探索性测试，猜数字的第二步也就是根据第一步猜的结果，来决定猜下一个数字所使用的策略非常重要。<strong>没有好的策略就会变成乱猜</strong>，而策略就需要你对游戏的规则、数字的特征以及二叉树查找等知识的积累和掌握。]]></description>
				<content:encoded><![CDATA[<p>Q: 如何做一名优秀的软件测试工程师？他至少具备哪些技术能力？</p>
<p>A: 软件测试工程师首先是一个软件工程师，也就是说他必须具备软件工程师的基本技术能力，比如对计算机结构系统（硬件，操作系统，内存，网络等）基本了解，再有就是算法数据结构，以及开发编程能力，最后就是对所工作领域的技术掌握。有了这些基本技术后，下面要掌握一些测试技术，比如黑盒白盒、等价类、边界值、功能测试、性能压力测试和安全性测试等。除了必须懂得技术硬技能外，要想成为一名优秀的软件测试工程师还必须有很强的软技能，这包括对产品质量的热情和沟通协调能力等。其中对产品质量的热情和专注尤为重要，因为兴趣是最好的老师，只有对所做的工作充满热情，你才会从平庸变成卓越。</p>
<p>Q: 怎么才能进行有效地探索性测试？另外很多优秀的软件测试工程师都能敏锐地嗅到bug，你认为如何训练这方面能力？</strong></p>
<p>A: 探索性测试不仅需要对产品熟悉，还需要掌握开发产品采用的技术，最后就是自己经验的积累，这三者缺少一个都很容易把探索性测试变成漫无目的的测试。因为探索性测试是边运行测试、边了解产品和边设计新的测试。它根据当前测试步骤产生的结果，加以分析判断，然后使用策略决定下一步会最有可能发现产品中的bug。我曾写过一篇介绍探索性测试的文章，那里面用猜数字的游戏来解释探索性测试，猜数字的第二步也就是根据第一步猜的结果，来决定猜下一个数字所使用的策略非常重要。<strong>没有好的策略就会变成乱猜</strong>，而策略就需要你对游戏的规则、数字的特征以及二叉树查找等知识的积累和掌握。</p>
<p>其实对bug的敏感度也是建立在以上三个方面的能力：产品、技术和经验。另外分享一个小技巧，测试人员可以经常把以前的bug拿过来分析和学习，比如当时是如何发现的？找出共性特征，及时做总结，时间长了自然就会提高发现bug的能力。在我带的一个团队中就经常让团队的人找一个自认为最好的bug，轮流在团队会议上和大家分享他发现该bug的过程，从而给团队其他人以启发和学习。</p>
<p>Q: 可以说微软、谷歌、亚马逊等公司代表着测试软件发展方向，他们是如何做软件测试的？他们在软件质量控制理念和实践方面，哪些地方值得我们借鉴？</p>
<p>A: 有很多因素决定一个公司如何做软件测试，其中最为重要的就是产品的特点，换句话说就是什么样的产品决定什么样的测试策略。即使在同一个公司，不同的产品也不是使用一成不变的测试方式。微软是传统桌面型产品的代表，由于桌面型产品的特点，使得微软在软件开发过程中做大量的测试，来保证软件发布时候的高质量。而对于谷歌亚马逊等互联网公司，他们的产品以网站和服务为主，于是他们采用不同的测试策略来保证网站和服务的高可用性。虽然不同公司团队具体测试实践或手段有所不同，但仔细分析他们在软件质量控制理念上有很多共性值得我们去借鉴，比如强调把质量提前，开发对代码质量负责，整个团队对产品质量负责，产品质量是从一开始就建立起来的而不是后天测试出来的等。</p>
]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/7808.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>WebDriver（一）</title>
		<link>http://www.xieziming.com/archives/7661.html</link>
		<comments>http://www.xieziming.com/archives/7661.html#comments</comments>
		<pubDate>Tue, 13 Nov 2012 16:19:21 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[Selenium]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=7661</guid>
		<description><![CDATA[WebDriver与之前Selenium的JS注入实现不同，直接利用了浏览器native support来操作浏览器。所以对于不同平台，不同的浏览器，必须依赖一个特定的浏览器的native component来实现把WebDriver API的调用转化为浏览器的native invoke。

在我们new一个WebDriver的过程中，Selenium首先会确认浏览器的native component是否存在可用而且版本匹配。接着就在目标浏览器里启动一整套Web Service，这套Web Service使用了Selenium自己设计定义的协议，名字叫做<strong>The WebDriver Wire Protocol</strong>。这套协议非常之强大，几乎可以操作浏览器做任何事情，包括打开、关闭、最大化、最小化、元素定位、元素点击、上传文件等等等等。

WebDriver Wire协议是通用的，也就是说不管是FirefoxDriver还是ChromeDriver，启动之后都会在某一个端口启动基于这套协议的Web Service。例如FirefoxDriver初始化成功之后，默认会从http://localhost:7055开始，而ChromeDriver则大概是http://localhost:46350之类的。接下来，我们调用WebDriver的任何API，都需要借助一个<strong>ComandExecutor</strong>发送一个命令，实际上是一个HTTP request给46350端口上的Web Service。在我们的HTTP request的body中，会以WebDriver Wire协议规定的<strong>JSON</strong>格式的字符串来告诉Selenium我们希望浏览器接下来做什么事情。

不同浏览器的WebDriver子类，都需要依赖特定的浏览器原生组件，例如Firefox就需要一个add-on名字叫webdriver.xpi。而IE的话就需要用到一个dll文件来转化Web Service的命令为浏览器native的调用。]]></description>
				<content:encoded><![CDATA[<p>WebDriver与之前Selenium的JS注入实现不同，直接利用了浏览器native support来操作浏览器。所以对于不同平台，不同的浏览器，必须依赖一个特定的浏览器的native component来实现把WebDriver API的调用转化为浏览器的native invoke。</p>
<p>在我们new一个WebDriver的过程中，Selenium首先会确认浏览器的native component是否存在可用而且版本匹配。接着就在目标浏览器里启动一整套Web Service，这套Web Service使用了Selenium自己设计定义的协议，名字叫做<strong>The WebDriver Wire Protocol</strong>。这套协议非常之强大，几乎可以操作浏览器做任何事情，包括打开、关闭、最大化、最小化、元素定位、元素点击、上传文件等等等等。</p>
<p>WebDriver Wire协议是通用的，也就是说不管是FirefoxDriver还是ChromeDriver，启动之后都会在某一个端口启动基于这套协议的Web Service。例如FirefoxDriver初始化成功之后，默认会从http://localhost:7055开始，而ChromeDriver则大概是http://localhost:46350之类的。接下来，我们调用WebDriver的任何API，都需要借助一个<strong>ComandExecutor</strong>发送一个命令，实际上是一个HTTP request给46350端口上的Web Service。在我们的HTTP request的body中，会以WebDriver Wire协议规定的<strong>JSON</strong>格式的字符串来告诉Selenium我们希望浏览器接下来做什么事情。</p>
<p>不同浏览器的WebDriver子类，都需要依赖特定的浏览器原生组件，例如Firefox就需要一个add-on名字叫webdriver.xpi。而IE的话就需要用到一个dll文件来转化Web Service的命令为浏览器native的调用。</p>
<p>关于WebDriver Wire协议的细节，比如希望了解这套Web Service能够做哪些事情，可以阅读Selenium官方的协议文档， 在Selenium的源码中，我们可以找到一个HttpCommandExecutor这个类，里面维护了一个Map<String, CommandInfo>，它负责将一个个代表命令的简单字符串key，转化为相应的URL，因为REST的理念是将所有的操作视作一个个状态，每一个状态对应一个URI。所以当我们以特定的URL发送HTTP request给这个RESTful web service之后，它就能解析出需要执行的操作。截取一段源码如下：</p>

<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;">nameToUrl <span style="color: #339933;">=</span> ImmutableMap.<span style="color: #339933;">&lt;</span>String, CommandInfo<span style="color: #339933;">&gt;</span>builder<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>  
        .<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span>NEW_SESSION, post<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/session&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>  
        .<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span>QUIT, delete<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/session/:sessionId&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>  
        .<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span>GET_CURRENT_WINDOW_HANDLE, get<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/session/:sessionId/window_handle&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>  
        .<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span>GET_WINDOW_HANDLES, get<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/session/:sessionId/window_handles&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>  
        .<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span>GET, post<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/session/:sessionId/url&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>  
&nbsp;
         <span style="color: #666666; font-style: italic;">// The Alert API is still experimental and should not be used.  </span>
        .<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span>GET_ALERT, get<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/session/:sessionId/alert&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>  
        .<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span>DISMISS_ALERT, post<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/session/:sessionId/dismiss_alert&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>  
        .<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span>ACCEPT_ALERT, post<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/session/:sessionId/accept_alert&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>  
        .<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span>GET_ALERT_TEXT, get<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/session/:sessionId/alert_text&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>  
        .<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span>SET_ALERT_VALUE, post<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/session/:sessionId/alert_text&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span></pre></div></div>

<p>可以看到实际发送的URL都是相对路径，后缀多以/session/:sessionId开头，这也意味着WebDriver每次启动浏览器都会分配一个独立的sessionId，多线程并行的时候彼此之间不会有冲突和干扰。例如我们最常用的一个WebDriver的API，getWebElement在这里就会转化为/session/:sessionId/element这个URL，然后在发出的HTTP request body内再附上具体的参数比如by ID还是CSS还是Xpath，各自的值又是什么。收到并执行了这个操作之后，也会回复一个HTTP response。内容也是JSON，会返回找到的WebElement的各种细节，比如text、CSS selector、tag name、class name等等。</p>
]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/7661.html/feed</wfw:commentRss>
		<slash:comments>1</slash:comments>
		</item>
		<item>
		<title>RESTful</title>
		<link>http://www.xieziming.com/archives/7666.html</link>
		<comments>http://www.xieziming.com/archives/7666.html#respond</comments>
		<pubDate>Sat, 10 Nov 2012 16:23:20 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[程序]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=7666</guid>
		<description><![CDATA[<strong>资源（Resources）</strong>

所谓"资源"，就是网络上的一个实体，或者说是网络上的一个具体信息。它可以是一段文本、一张图片、一首歌曲、一种服务，总之就是一个具体的实在。你可以用一个URI（统一资源定位符）指向它，每种资源对应一个特定的URI。要获取这个资源，访问它的URI就可以，因此URI就成了每一个资源的地址或独一无二的识别符。

<strong>表现层（Representation）</strong>
"资源"是一种信息实体，它可以有多种外在表现形式。我们把"资源"具体呈现出来的形式，叫做它的"表现层"（Representation）。比如，文本可以用txt格式表现，也可以用HTML格式、XML格式、JSON格式表现，甚至可以采用二进制格式；图片可以用JPG格式表现，也可以用PNG格式表现。

URI只代表资源的实体，不代表它的形式。严格地说，有些网址最后的".html"后缀名是不必要的，因为这个后缀名表示格式，属于"表现层"范畴，而URI应该只代表"资源"的位置。它的具体表现形式，应该在HTTP请求的头信息中用Accept和Content-Type字段指定，这两个字段才是对"表现层"的描述。

<strong>状态转化（State Transfer）</strong>
互联网通信协议HTTP协议，是一个无状态协议。这意味着，所有的状态都保存在服务器端。因此，如果客户端想要操作服务器，必须通过某种手段，让服务器端发生"状态转化"（State Transfer）。而这种转化是建立在表现层之上的，所以就是"表现层状态转化"。

客户端用到的手段，只能是HTTP协议。具体来说，就是HTTP协议里面，四个表示操作方式的动词：GET、POST、PUT、DELETE。它们分别对应四种基本操作：GET用来获取资源，POST用来新建资源（也可以用于更新资源），PUT用来更新资源，DELETE用来删除资源。]]></description>
				<content:encoded><![CDATA[<p>要理解RESTful架构，最好的方法就是去理解Representational State Transfer这个词组到底是什么意思，它的每一个词代表了什么涵义。如果你把这个名称搞懂了，也就不难体会REST是一种什么样的设计。</p>
<p><strong>资源（Resources）</strong></p>
<p>所谓&#8221;资源&#8221;，就是网络上的一个实体，或者说是网络上的一个具体信息。它可以是一段文本、一张图片、一首歌曲、一种服务，总之就是一个具体的实在。你可以用一个URI（统一资源定位符）指向它，每种资源对应一个特定的URI。要获取这个资源，访问它的URI就可以，因此URI就成了每一个资源的地址或独一无二的识别符。</p>
<p><strong>表现层（Representation）</strong><br />
&#8220;资源&#8221;是一种信息实体，它可以有多种外在表现形式。我们把&#8221;资源&#8221;具体呈现出来的形式，叫做它的&#8221;表现层&#8221;（Representation）。比如，文本可以用txt格式表现，也可以用HTML格式、XML格式、JSON格式表现，甚至可以采用二进制格式；图片可以用JPG格式表现，也可以用PNG格式表现。</p>
<p>URI只代表资源的实体，不代表它的形式。严格地说，有些网址最后的&#8221;.html&#8221;后缀名是不必要的，因为这个后缀名表示格式，属于&#8221;表现层&#8221;范畴，而URI应该只代表&#8221;资源&#8221;的位置。它的具体表现形式，应该在HTTP请求的头信息中用Accept和Content-Type字段指定，这两个字段才是对&#8221;表现层&#8221;的描述。</p>
<p><strong>状态转化（State Transfer）</strong><br />
互联网通信协议HTTP协议，是一个无状态协议。这意味着，所有的状态都保存在服务器端。因此，如果客户端想要操作服务器，必须通过某种手段，让服务器端发生&#8221;状态转化&#8221;（State Transfer）。而这种转化是建立在表现层之上的，所以就是&#8221;表现层状态转化&#8221;。</p>
<p>客户端用到的手段，只能是HTTP协议。具体来说，就是HTTP协议里面，四个表示操作方式的动词：GET、POST、PUT、DELETE。它们分别对应四种基本操作：GET用来获取资源，POST用来新建资源（也可以用于更新资源），PUT用来更新资源，DELETE用来删除资源。</p>
<p>说了这么多，到底为什么要用REST这种设计风格呢，好处如下：</p>
<p>（1）可以充分利用缓存cache来提高响应速度<br />
（2）通讯本身的无状态可以让不同的服务器处理所有类型的请求，提供了服务器的扩展性<br />
（3）浏览器就可以充当客户端，简化软件需求</p>
]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/7666.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>遍历windows窗口控件</title>
		<link>http://www.xieziming.com/archives/7620.html</link>
		<comments>http://www.xieziming.com/archives/7620.html#respond</comments>
		<pubDate>Sat, 10 Nov 2012 16:05:29 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[程序]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=7620</guid>
		<description><![CDATA[<strong>FindWindowEx ：</strong>
<code lang="cpp">
HWND FindWindowEx(
　　HWND hwndParent, // handle to parent window
　　HWND hwndChildAfter, // handle to child window
　　LPCTSTR lpszClass, // class name
　　LPCTSTR lpszWindow // window name
　　);
</code>
参数：
（1）hwndParent：要查找子窗口的父窗口句柄。如果hwndParent为NULL，则函数以桌面窗口为父窗口，查找桌面窗口的所有子窗口。如果hwndParent是HWND_MESSAGE，函数仅查找所有消息窗口。

（2）hwndChildAfter ：子窗口句柄。查找从在Z序中的下一个子窗口开始。子窗口必须为hwndParent窗口的直接子窗口而非后代窗口。如果HwndChildAfter为NULL，查找从hwndParent的第一个子窗口开始。如果hwndParent 和 hwndChildAfter同时为NULL，则函数查找所有的顶层窗口及消息窗口。

（3）lpszClass：指向一个指定了类名的空结束字符串，或一个标识类名字符串的成员的指针。如果该参数为一个成员，则它必须为前次调用theGlobaIAddAtom函数产生的全局成员。该成员为16位，必须位于lpClassName的低16位，高位必须为0。]]></description>
				<content:encoded><![CDATA[<p>我们要做的事有两个：<br />
（1）遍历/查找 windows 窗口<br />
（2）遍历windows窗口里的所有控件</p>
<p><strong>FindWindowEx ：</strong></p>

<div class="wp_code"><div class="pre"><pre class="cpp" style="font-family:'Times New Roman',Garamond, Times;">HWND FindWindowEx<span style="color: #008000;">&#40;</span>
　　HWND hwndParent, <span style="color: #666666;">// handle to parent window</span>
　　HWND hwndChildAfter, <span style="color: #666666;">// handle to child window</span>
　　LPCTSTR lpszClass, <span style="color: #666666;">// class name</span>
　　LPCTSTR lpszWindow <span style="color: #666666;">// window name</span>
　　<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span></pre></div></div>

<p>参数：<br />
（1）hwndParent：要查找子窗口的父窗口句柄。如果hwndParent为NULL，则函数以桌面窗口为父窗口，查找桌面窗口的所有子窗口。如果hwndParent是HWND_MESSAGE，函数仅查找所有消息窗口。</p>
<p>（2）hwndChildAfter ：子窗口句柄。查找从在Z序中的下一个子窗口开始。子窗口必须为hwndParent窗口的直接子窗口而非后代窗口。如果HwndChildAfter为NULL，查找从hwndParent的第一个子窗口开始。如果hwndParent 和 hwndChildAfter同时为NULL，则函数查找所有的顶层窗口及消息窗口。</p>
<p>（3）lpszClass：指向一个指定了类名的空结束字符串，或一个标识类名字符串的成员的指针。如果该参数为一个成员，则它必须为前次调用theGlobaIAddAtom函数产生的全局成员。该成员为16位，必须位于lpClassName的低16位，高位必须为0。</p>
<p>（4）lpszWindow：指向一个指定了窗口名（窗口标题）的空结束字符串。如果该参数为 NULL，则为所有窗口全匹配。</p>
<p><strong>FindWindow ：</strong></p>

<div class="wp_code"><div class="pre"><pre class="cpp" style="font-family:'Times New Roman',Garamond, Times;">HWND FindWindow<span style="color: #008000;">&#40;</span>
　　LPCSTR lpClassName,
　　LPCSTR lpWindowName
　　<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span></pre></div></div>

<p>参数：<br />
（1）lpClassName ： 指向一个以null结尾的、用来指定类名的字符串或一个可以确定类名字符串的原子。如果这个参数是一个原子，那么它必须是一个在调用此函数前已经通过GlobalAddAtom函数创建好的全局原子。这个原子（一个16bit的值），必须被放置在lpClassName的低位字节中，lpClassName的高位字节置零。如果该参数为null时，将会寻找任何与lpWindowName参数匹配的窗口。<br />
　　<br />
（2）lpWindowName ： 指向一个以null结尾的、用来指定窗口名（即窗口标题）的字符串。如果此参数为NULL，则匹配所有窗口名。</p>
]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/7620.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>QTP插件拓展（C#）</title>
		<link>http://www.xieziming.com/archives/7614.html</link>
		<comments>http://www.xieziming.com/archives/7614.html#respond</comments>
		<pubDate>Sat, 10 Nov 2012 15:01:17 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[QTP]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=7614</guid>
		<description><![CDATA[QTP能录制那些不被直接支持的.NET控件，但是以低级鼠标和键盘操作，例如“Drag”、“Drop”，这样的脚本的可理解性、可维护性都很差，并且由于位置受分辨率等因素的影响，容易导致回放脚本时失败。
<font color="#00BB00"><strong>安装Custom Server模板</strong></font>
通过安装QTP的.NET插件提供的Custom Server C#项目模板到Visual Studio.NET中，利用Visual Studio.NET开发工具来建立Custom Server项目，适用.NET插件的扩展模块。在QTP安装目录中的“\bin\Custom ”目录下，可以找到名为“InstWizard.msi”的安装文件，用于安装Custom Server模板。安装完成后，打开Visual Studio.NET 2005，可以发现在C#项目中多了一个名为“QuickTest CustomServer”的模板。
<font color="#00BB00"><strong>建立.NET控件的测试扩展项目</strong></font>
安装好CustomServer项目模板后，就可以开始创建CustomServer项目，编写QTP的.NET插件扩展程序。
（1）选择“QuickTest CustomServer”，输入项目名和存储位置后，单击“确定”按钮。
（2）在“Server class name”中输入“TrackBarCustomerServer”，选中“Customize Record process”和“Customize Run process”，接受其他的默认设置，然后单击“Next”按钮。
（3）在“Customized Control type”中输入“System.Windows.Forms.TrackBar”，然后单击“Finish”按钮，完成设置。这样就创建了一个基本的CustomServer项目框架。
<font color="#00BB00"><strong>创建CustomServer项目</strong></font>
（1）实现控件录制逻辑
创建了基本的项目框架后，还需要实现控件的录制逻辑。在“TrackBarCustomerServer”类中，添加如下方法。
<code lang="java">
public void OnValueChanged(object sender, EventArgs e){
       System.Windows.Forms.TrackBar trackBar = (System.Windows.Forms. TrackBar) sender;
       // 获取新的值
       int newValue = trackBar.Value;
       // 把SetValue 命令录制到测试脚本中
       RecordFunction("SetValue", RecordingMode.RECORD_SEND_LINE, newValue);
}
</code>]]></description>
				<content:encoded><![CDATA[<p>QTP能录制那些不被直接支持的.NET控件，但是以低级鼠标和键盘操作，例如“Drag”、“Drop”，这样的脚本的可理解性、可维护性都很差，并且由于位置受分辨率等因素的影响，容易导致回放脚本时失败。</p>
<p><font color="#00BB00"><strong>安装Custom Server模板</strong></font></p>
<p>通过安装QTP的.NET插件提供的Custom Server C#项目模板到Visual Studio.NET中，利用Visual Studio.NET开发工具来建立Custom Server项目，适用.NET插件的扩展模块。在QTP安装目录中的“\bin\Custom ”目录下，可以找到名为“InstWizard.msi”的安装文件，用于安装Custom Server模板。安装完成后，打开Visual Studio.NET 2005，可以发现在C#项目中多了一个名为“QuickTest CustomServer”的模板。</p>
<p><font color="#00BB00"><strong>建立.NET控件的测试扩展项目</strong></font></p>
<p>安装好CustomServer项目模板后，就可以开始创建CustomServer项目，编写QTP的.NET插件扩展程序。<br />
（1）选择“QuickTest CustomServer”，输入项目名和存储位置后，单击“确定”按钮。<br />
（2）在“Server class name”中输入“TrackBarCustomerServer”，选中“Customize Record process”和“Customize Run process”，接受其他的默认设置，然后单击“Next”按钮。<br />
（3）在“Customized Control type”中输入“System.Windows.Forms.TrackBar”，然后单击“Finish”按钮，完成设置。这样就创建了一个基本的CustomServer项目框架。</p>
<p><font color="#00BB00"><strong>创建CustomServer项目</strong></font></p>
<p>（1）实现控件录制逻辑<br />
创建了基本的项目框架后，还需要实现控件的录制逻辑。在“TrackBarCustomerServer”类中，添加如下方法。</p>

<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> OnValueChanged<span style="color: #009900;">&#40;</span>object sender, EventArgs e<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
       <span style="color: #003399;">System</span>.<span style="color: #006633;">Windows</span>.<span style="color: #006633;">Forms</span>.<span style="color: #006633;">TrackBar</span> trackBar <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">System</span>.<span style="color: #006633;">Windows</span>.<span style="color: #006633;">Forms</span>. <span style="color: #006633;">TrackBar</span><span style="color: #009900;">&#41;</span> sender<span style="color: #339933;">;</span>
       <span style="color: #666666; font-style: italic;">// 获取新的值</span>
       <span style="color: #000066; font-weight: bold;">int</span> newValue <span style="color: #339933;">=</span> trackBar.<span style="color: #006633;">Value</span><span style="color: #339933;">;</span>
       <span style="color: #666666; font-style: italic;">// 把SetValue 命令录制到测试脚本中</span>
       RecordFunction<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SetValue&quot;</span>, RecordingMode.<span style="color: #006633;">RECORD_SEND_LINE</span>, newValue<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></div>

<p>该方法用于在TrackBar控件的ValueChanged事件发生时，获取TrackBar控件的新值，然后，调用RecordFunction方法的SetValue命令，设置TrackBar控件的新值。</p>
<p>RecordFunction是QTP的.NET插件扩展API提供的一个方法，用于往测试脚本中写入一行。其使用方法如下：</p>

<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> RecordFunction<span style="color: #009900;">&#40;</span>
       string strFunc, <span style="color: #666666; font-style: italic;">// 回放脚本时，测试对象执行的方法</span>
       RecordingMode eMode, <span style="color: #666666; font-style: italic;">// RecordingMode枚举中的一个</span>
       params object<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> parameters <span style="color: #666666; font-style: italic;">// 要写入的变量值</span>
<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></div>

<p>（2）注册TrackBar控件的事件处理器<br />
在InitEventListener方法中，添加如下代码，用于注册TrackBar控件的OnValueChanged事件处理器：</p>

<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #000000; font-weight: bold;">public</span> override <span style="color: #000066; font-weight: bold;">void</span> InitEventListener<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
       <span style="color: #666666; font-style: italic;">// 为OnValueChanged新建一个事件处理器</span>
       <span style="color: #003399;">Delegate</span> e <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">System</span>.<span style="color: #006633;">EventHandler</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">OnValueChanged</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
       <span style="color: #666666; font-style: italic;">// 添加处理器</span>
       AddHandler<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;ValueChanged&quot;</span>, e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></div>

<p>（3）实现控件的运行逻辑<br />
还要实现控件的测试运行逻辑，在测试运行时，告诉QTP按指定的行为操作控件。因此，需要编写TrackBar控件的SetValue方法。在ITrackBarCustomerServerReplay接口中，添加SetValue方法，如下所示：</p>

<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">interface</span> ITrackBarCustomerServerReplay<span style="color: #009900;">&#123;</span>
       <span style="color: #666666; font-style: italic;">// 在ITrackBarCustomerServerReplay接口中添加SetValue方法</span>
       <span style="color: #000066; font-weight: bold;">void</span> SetValue<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> newValue<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></div>

<p>然后在TrackBarCustomerServer类中添加SetValue方法的实现，如下代码所示：</p>

<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> SetValue<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> newValue<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
       <span style="color: #003399;">System</span>.<span style="color: #006633;">Windows</span>.<span style="color: #006633;">Forms</span>.<span style="color: #006633;">TrackBar</span> trackBar <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">System</span>.<span style="color: #006633;">Windows</span>.<span style="color: #006633;">Forms</span>. <span style="color: #006633;">TrackBar</span><span style="color: #009900;">&#41;</span> SourceControl<span style="color: #339933;">;</span>
       <span style="color: #666666; font-style: italic;">// 改变trackBar控件的值</span>
       trackBar.<span style="color: #006633;">Value</span> <span style="color: #339933;">=</span> newValue<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></div>

<p>（4）对QTP进行配置<br />
在完成上面的代码编写后，编译整个项目，然后，就可以通过配置项目中的“Configuration.XML”文件，以便在QTP的录制和测试运行TrackBar控件的过程中使用这个Custom Server的逻辑。<br />
（4.1）双击打开Configuration.XML文件。<br />
XML文件内容大致如下所示：</p>

<div class="wp_code"><div class="pre"><pre class="xml" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #808080; font-style: italic;">&lt;!-- Merge this XML content into file &quot;&lt;QuickTest Professional&gt;\dat\ SwfConfig.xml&quot;. --&gt;</span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;control</span> <span style="color: #000066;">Type</span>=<span style="color: #ff0000;">&quot;System.Windows.Forms.TrackBar&quot;</span> <span style="color: #000000; font-weight: bold;">&gt;</span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;customrecord<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;component<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;context<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>AUT<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/context<span style="color: #000000; font-weight: bold;">&gt;</span></span><span style="color: #000000; font-weight: bold;">&lt;dllname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>D:\QTP\MyWork\QuickTestCustomServer1\QuickTestCustomServer1\Bin\ QuickTestCustomServer1.dll<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dllname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;typename<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>QuickTestCustomServer1.TrackBarCustomerServer <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/typename<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/component<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/customrecord<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;customreplay<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;component<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;context<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>AUT<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/context<span style="color: #000000; font-weight: bold;">&gt;</span></span><span style="color: #000000; font-weight: bold;">&lt;dllname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>D:\QTP\MyWork\QuickTestCustomServer1\QuickTestCustomServer1\Bin\ QuickTestCustomServer1.dll<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dllname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;typename<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>QuickTestCustomServer1.TrackBarCustomerServer <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/typename<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/component<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/customreplay<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/control<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></div></div>

<p>（4.2）把其中的“&lt;Control&gt;”到“&lt;/Control&gt;”的这段内容复制，然后，打开&lt; QTP安装目录 &gt;\dat 中的SwfConfig.xml文件，把刚才复制的内容替换SwfConfig.xml文件中的“&lt;Controls&gt;”到“&lt;/Controls&gt;”段内的内容。粘贴后，SwfConfig.xml文件的内容如下所示：</p>

<div class="wp_code"><div class="pre"><pre class="xml" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #009900;">&lt; ?xml <span style="color: #000066;">version</span>=<span style="color: #ff0000;">&quot;1.0&quot;</span> <span style="color: #000066;">encoding</span>=<span style="color: #ff0000;">&quot;UTF-8&quot;</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;controls<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;control</span> <span style="color: #000066;">Type</span>=<span style="color: #ff0000;">&quot;System.Windows.Forms.TrackBar&quot;</span> <span style="color: #000000; font-weight: bold;">&gt;</span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;customrecord<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;component<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;context<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>AUT<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/context<span style="color: #000000; font-weight: bold;">&gt;</span></span><span style="color: #000000; font-weight: bold;">&lt;dllname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>D:\QTP\MyWork\QuickTestCustomServer1\QuickTestCustomServer1\Bin\ QuickTestCustomServer1.dll<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dllname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;typename<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>QuickTestCustomServer1.TrackBarCustomerServer <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/typename<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/component<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/customrecord<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;customreplay<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;component<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;context<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>AUT<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/context<span style="color: #000000; font-weight: bold;">&gt;</span></span><span style="color: #000000; font-weight: bold;">&lt;dllname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>D:\QTP\MyWork\QuickTestCustomServer1\QuickTestCustomServer1\Bin\ QuickTestCustomServer1.dll<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dllname<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;typename<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>QuickTestCustomServer1.TrackBarCustomerServer <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/typename<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/component<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/customreplay<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/control<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/controls<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></div></div>

<p>（4.3）确保<dllname>元素中包含了正确的Custom Server编译的DLL的正确路径，然后保存SwfConfig.xml文件。</p>
]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/7614.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>QTP调用外部函数</title>
		<link>http://www.xieziming.com/archives/7729.html</link>
		<comments>http://www.xieziming.com/archives/7729.html#respond</comments>
		<pubDate>Sat, 10 Nov 2012 14:31:50 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[QTP]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=7729</guid>
		<description><![CDATA[QTP主要提供了3种DLL的调用方式，这3种调用方式分别为Extern、CreateObject和DotNetFactory。这3种调用方式都分别对应着不同类型的DLL。

首先Extern所调用的DLL为WIN32 API - DLL，Createobject所调用的是ActiveX类型的DLL，这类DLL其实应用的最多，AOM \ EOM等都是此类型的DLL，最后一种.NET Factory是直接调用.Net framework 或者.NET自定义的DLL。

<strong>Extern：</strong>
(1)例子一：
<code lang="vb">
'#######启动浏览器######## 
systemutil.Run "iexplore.exe"

'#######创建API  Extern对象########## 
Extern.Declare micHWnd, "GetForegroundWindow", "user32.dll", "GetForegroundWindow"

'######使用WIN32 API获取窗口的句柄###### 
hwnd = Extern.GetForegroundWindow()

'########通过获取的句柄控制浏览器窗口并跳转百度##### 
Browser("hwnd:=" &#038; hwnd).Navigate "http://www.baidu.com"
</code>]]></description>
				<content:encoded><![CDATA[<p>QTP主要提供了3种DLL的调用方式，这3种调用方式分别为Extern、CreateObject和DotNetFactory。这3种调用方式都分别对应着不同类型的DLL。</p>
<p>首先Extern所调用的DLL为WIN32 API &#8211; DLL，Createobject所调用的是ActiveX类型的DLL，这类DLL其实应用的最多，AOM \ EOM等都是此类型的DLL，最后一种.NET Factory是直接调用.Net framework 或者.NET自定义的DLL。</p>
<p><strong>Extern：</strong><br />
例子一：</p>

<div class="wp_code"><div class="pre"><pre class="vb" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #008000;">'#######启动浏览器######## 
</span>systemutil.Run <span style="color: #800000;">&quot;iexplore.exe&quot;</span>
&nbsp;
<span style="color: #008000;">'#######创建API  Extern对象########## 
</span>Extern.<span style="color: #151B8D; font-weight: bold;">Declare</span> micHWnd, <span style="color: #800000;">&quot;GetForegroundWindow&quot;</span>, <span style="color: #800000;">&quot;user32.dll&quot;</span>, <span style="color: #800000;">&quot;GetForegroundWindow&quot;</span>
&nbsp;
<span style="color: #008000;">'######使用WIN32 API获取窗口的句柄###### 
</span>hwnd = Extern.GetForegroundWindow()
&nbsp;
<span style="color: #008000;">'########通过获取的句柄控制浏览器窗口并跳转百度##### 
</span>Browser(<span style="color: #800000;">&quot;hwnd:=&quot;</span> &amp; hwnd).Navigate <span style="color: #800000;">&quot;http://www.baidu.com&quot;</span></pre></div></div>

<p>例子二：</p>

<div class="wp_code"><div class="pre"><pre class="vb" style="font-family:'Times New Roman',Garamond, Times;">Const SW_MINIMIZE = 6
<span style="color: #008000;">'声明user32.dll中的ShowWindow方法
</span>Extern.<span style="color: #151B8D; font-weight: bold;">Declare</span> micLong,<span style="color: #800000;">&quot;ShowWindow&quot;</span>,<span style="color: #800000;">&quot;user32.dll&quot;</span>,<span style="color: #800000;">&quot;ShowWindow&quot;</span>,micLong,micLong
&nbsp;
<span style="color: #008000;">'高亮QTP窗口对象
</span>Window(<span style="color: #800000;">&quot;text:=QuickTest.*&quot;</span>).highlight
&nbsp;
<span style="color: #008000;">'获取QTP自身的窗口对象的句柄属性
</span>ohwnd = Window(<span style="color: #800000;">&quot;text:=QuickTest.*&quot;</span>).GetROProperty(<span style="color: #800000;">&quot;HWND&quot;</span>)
&nbsp;
<span style="color: #008000;">'调用ShowWindow方法 并加入最小化窗口参数
</span>Extern.ShowWindow ohwnd,SW_MINIMIZE
&nbsp;
<span style="color: #008000;">'等待两秒钟
</span>wait 2</pre></div></div>

<p>注：QTP本身并没有加入反HOOK注入，因此，同样可以把QTP自身程序窗口加入到对象库中并对其进行一些操作。以上脚本就是直接通过Window(&#8220;text:=QuickTest.*&#8221;)获取到QTP对象窗口的，获取到之后即可方便做操作。</p>
<p><strong>Createobject：</strong></p>

<div class="wp_code"><div class="pre"><pre class="vb" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #151B8D; font-weight: bold;">Set</span> oIE = <span style="color: #E56717; font-weight: bold;">CreateObject</span>(<span style="color: #800000;">&quot;InternetExplorer.Application&quot;</span>)
oIE.Visible = <span style="color: #00C2FF; font-weight: bold;">True</span>  <span style="color: #008000;">'设置可见
</span>oIE.Navigate <span style="color: #800000;">&quot;http://www.baidu.com&quot;</span>  '跳转URL</pre></div></div>

<p><strong>DotNetFactory：</strong></p>

<div class="wp_code"><div class="pre"><pre class="vb" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #151B8D; font-weight: bold;">Set</span> var_CreateInstance = DotNetFactory.CreateInstance（<span style="color: #800000;">&quot;System.Windows.Forms.Form&quot;</span>， <span style="color: #800000;">&quot;System.Windows.Forms&quot;</span>）
var_CreateInstance.Show</pre></div></div>

<p>下面我说一下如何用DotNetFactory调用我们自己开发的。net类库。</p>
<p>首先用Visual Studio 2003或者2005创建一个新项目：类库，我用的是C#.新建一个类，假设命名空间是Test.myTest，类名是QTPTest。我们再新建一个公共方法：　public string DoAction（）假设编译后产生的文件是d：\mtTest.dll.下面我们在QTP里面写脚本：</p>

<div class="wp_code"><div class="pre"><pre class="vb" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #151B8D; font-weight: bold;">Set</span> obj = DotNetFactory.CreateInstance（<span style="color: #800000;">&quot;Test.myTest.QTPTest&quot;</span>， <span style="color: #800000;">&quot;d：\mtTest.dll&quot;</span>）
obj.DoAction</pre></div></div>

]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/7729.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>控制window程序</title>
		<link>http://www.xieziming.com/archives/7626.html</link>
		<comments>http://www.xieziming.com/archives/7626.html#respond</comments>
		<pubDate>Fri, 09 Nov 2012 16:38:34 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[程序]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=7626</guid>
		<description><![CDATA[获取进程管理器中被选中进程的名字 ：
<code lang="cpp">
int APIENTRY WinMain(HINSTANCE hInstance,HINSTANCE hPrevInstance,LPSTR lpCmdLine,int nCmdShow){
	HWND hwnd;
	int iItem=0;
	LVITEM lvitem, *plvitem;
	char ItemBuf[512],*pItem;
	DWORD PID;
	HANDLE hProcess;
	hwnd=FindWindow("#32770","Windows 任务管理器");
	hwnd=FindWindowEx(hwnd,0,"#32770",0);
	hwnd=FindWindowEx(hwnd,0,"SysListView32",0);
	if (!hwnd)
		MessageBox(NULL,"[Windows 任务管理器] 尚未启动！","错误！",NULL);
	else{
		iItem=SendMessage(hwnd,LVM_GETNEXTITEM,-1,LVNI_SELECTED);
		if (iItem==-1)
			MessageBox(NULL,"没有指定目标进程 ！","错误！",NULL);
		else{
			GetWindowThreadProcessId(hwnd, &#038;PID);
			hProcess=OpenProcess(PROCESS_ALL_ACCESS,false,PID);
			if (!hProcess)
				MessageBox(NULL,"获取进程句柄操作失败！","错误！",NULL);
			else{
				plvitem=(LVITEM*)VirtualAllocEx(hProcess, NULL, sizeof(LVITEM), MEM_COMMIT, PAGE_READWRITE);
				pItem=(char*)VirtualAllocEx(hProcess, NULL, 512, MEM_COMMIT, PAGE_READWRITE);
				if ((!plvitem)&#124;&#124;(!pItem))
					MessageBox(NULL,"无法分配内存！","错误！",NULL);
				else{
					lvitem.cchTextMax=512;
					lvitem.iSubItem=0; //ProcessName
					lvitem.pszText=pItem;
					WriteProcessMemory(hProcess, plvitem, &#038;lvitem, sizeof(LVITEM), NULL);
					SendMessage(hwnd, LVM_GETITEMTEXT, (WPARAM)iItem, (LPARAM)plvitem);
					ReadProcessMemory(hProcess, pItem, ItemBuf, 512, NULL);	
					MessageBox(NULL,ItemBuf,"ItemBuf",NULL);
				}
			}
		}
	}
	//释放内存
	CloseHandle(hwnd);
	CloseHandle(hProcess);
	VirtualFreeEx(hProcess, plvitem, 0, MEM_RELEASE);
	VirtualFreeEx(hProcess, pItem, 0, MEM_RELEASE);
	return 0;
}
</code>]]></description>
				<content:encoded><![CDATA[<p>获取进程管理器中被选中进程的名字 ：</p>

<div class="wp_code"><div class="pre"><pre class="cpp" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #0000ff;">int</span> APIENTRY WinMain<span style="color: #008000;">&#40;</span>HINSTANCE hInstance,HINSTANCE hPrevInstance,LPSTR lpCmdLine,<span style="color: #0000ff;">int</span> nCmdShow<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#123;</span>
	HWND hwnd<span style="color: #008080;">;</span>
	<span style="color: #0000ff;">int</span> iItem<span style="color: #000080;">=</span><span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
	LVITEM lvitem, <span style="color: #000040;">*</span>plvitem<span style="color: #008080;">;</span>
	<span style="color: #0000ff;">char</span> ItemBuf<span style="color: #008000;">&#91;</span><span style="color: #0000dd;">512</span><span style="color: #008000;">&#93;</span>,<span style="color: #000040;">*</span>pItem<span style="color: #008080;">;</span>
	DWORD PID<span style="color: #008080;">;</span>
	HANDLE hProcess<span style="color: #008080;">;</span>
	hwnd<span style="color: #000080;">=</span>FindWindow<span style="color: #008000;">&#40;</span><span style="color: #FF0000;">&quot;#32770&quot;</span>,<span style="color: #FF0000;">&quot;Windows 任务管理器&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
	hwnd<span style="color: #000080;">=</span>FindWindowEx<span style="color: #008000;">&#40;</span>hwnd,<span style="color: #0000dd;">0</span>,<span style="color: #FF0000;">&quot;#32770&quot;</span>,<span style="color: #0000dd;">0</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
	hwnd<span style="color: #000080;">=</span>FindWindowEx<span style="color: #008000;">&#40;</span>hwnd,<span style="color: #0000dd;">0</span>,<span style="color: #FF0000;">&quot;SysListView32&quot;</span>,<span style="color: #0000dd;">0</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
	<span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #000040;">!</span>hwnd<span style="color: #008000;">&#41;</span>
		MessageBox<span style="color: #008000;">&#40;</span><span style="color: #0000ff;">NULL</span>,<span style="color: #FF0000;">&quot;[Windows 任务管理器] 尚未启动！&quot;</span>,<span style="color: #FF0000;">&quot;错误！&quot;</span>,<span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
	<span style="color: #0000ff;">else</span><span style="color: #008000;">&#123;</span>
		iItem<span style="color: #000080;">=</span>SendMessage<span style="color: #008000;">&#40;</span>hwnd,LVM_GETNEXTITEM,<span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>,LVNI_SELECTED<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
		<span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>iItem<span style="color: #000080;">==</span><span style="color: #000040;">-</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#41;</span>
			MessageBox<span style="color: #008000;">&#40;</span><span style="color: #0000ff;">NULL</span>,<span style="color: #FF0000;">&quot;没有指定目标进程 ！&quot;</span>,<span style="color: #FF0000;">&quot;错误！&quot;</span>,<span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
		<span style="color: #0000ff;">else</span><span style="color: #008000;">&#123;</span>
			GetWindowThreadProcessId<span style="color: #008000;">&#40;</span>hwnd, <span style="color: #000040;">&amp;</span>PID<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
			hProcess<span style="color: #000080;">=</span>OpenProcess<span style="color: #008000;">&#40;</span>PROCESS_ALL_ACCESS,<span style="color: #0000ff;">false</span>,PID<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
			<span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #000040;">!</span>hProcess<span style="color: #008000;">&#41;</span>
				MessageBox<span style="color: #008000;">&#40;</span><span style="color: #0000ff;">NULL</span>,<span style="color: #FF0000;">&quot;获取进程句柄操作失败！&quot;</span>,<span style="color: #FF0000;">&quot;错误！&quot;</span>,<span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
			<span style="color: #0000ff;">else</span><span style="color: #008000;">&#123;</span>
				plvitem<span style="color: #000080;">=</span><span style="color: #008000;">&#40;</span>LVITEM<span style="color: #000040;">*</span><span style="color: #008000;">&#41;</span>VirtualAllocEx<span style="color: #008000;">&#40;</span>hProcess, <span style="color: #0000ff;">NULL</span>, <span style="color: #0000dd;">sizeof</span><span style="color: #008000;">&#40;</span>LVITEM<span style="color: #008000;">&#41;</span>, MEM_COMMIT, PAGE_READWRITE<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
				pItem<span style="color: #000080;">=</span><span style="color: #008000;">&#40;</span><span style="color: #0000ff;">char</span><span style="color: #000040;">*</span><span style="color: #008000;">&#41;</span>VirtualAllocEx<span style="color: #008000;">&#40;</span>hProcess, <span style="color: #0000ff;">NULL</span>, <span style="color: #0000dd;">512</span>, MEM_COMMIT, PAGE_READWRITE<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
				<span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#40;</span><span style="color: #000040;">!</span>plvitem<span style="color: #008000;">&#41;</span><span style="color: #000040;">||</span><span style="color: #008000;">&#40;</span><span style="color: #000040;">!</span>pItem<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span>
					MessageBox<span style="color: #008000;">&#40;</span><span style="color: #0000ff;">NULL</span>,<span style="color: #FF0000;">&quot;无法分配内存！&quot;</span>,<span style="color: #FF0000;">&quot;错误！&quot;</span>,<span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
				<span style="color: #0000ff;">else</span><span style="color: #008000;">&#123;</span>
					lvitem.<span style="color: #007788;">cchTextMax</span><span style="color: #000080;">=</span><span style="color: #0000dd;">512</span><span style="color: #008080;">;</span>
					lvitem.<span style="color: #007788;">iSubItem</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span><span style="color: #008080;">;</span> <span style="color: #666666;">//ProcessName</span>
					lvitem.<span style="color: #007788;">pszText</span><span style="color: #000080;">=</span>pItem<span style="color: #008080;">;</span>
					WriteProcessMemory<span style="color: #008000;">&#40;</span>hProcess, plvitem, <span style="color: #000040;">&amp;</span>lvitem, <span style="color: #0000dd;">sizeof</span><span style="color: #008000;">&#40;</span>LVITEM<span style="color: #008000;">&#41;</span>, <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
					SendMessage<span style="color: #008000;">&#40;</span>hwnd, LVM_GETITEMTEXT, <span style="color: #008000;">&#40;</span>WPARAM<span style="color: #008000;">&#41;</span>iItem, <span style="color: #008000;">&#40;</span>LPARAM<span style="color: #008000;">&#41;</span>plvitem<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
					ReadProcessMemory<span style="color: #008000;">&#40;</span>hProcess, pItem, ItemBuf, <span style="color: #0000dd;">512</span>, <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>	
					MessageBox<span style="color: #008000;">&#40;</span><span style="color: #0000ff;">NULL</span>,ItemBuf,<span style="color: #FF0000;">&quot;ItemBuf&quot;</span>,<span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
				<span style="color: #008000;">&#125;</span>
			<span style="color: #008000;">&#125;</span>
		<span style="color: #008000;">&#125;</span>
	<span style="color: #008000;">&#125;</span>
	<span style="color: #666666;">//释放内存</span>
	CloseHandle<span style="color: #008000;">&#40;</span>hwnd<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
	CloseHandle<span style="color: #008000;">&#40;</span>hProcess<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
	VirtualFreeEx<span style="color: #008000;">&#40;</span>hProcess, plvitem, <span style="color: #0000dd;">0</span>, MEM_RELEASE<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
	VirtualFreeEx<span style="color: #008000;">&#40;</span>hProcess, pItem, <span style="color: #0000dd;">0</span>, MEM_RELEASE<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
	<span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
<span style="color: #008000;">&#125;</span></pre></div></div>

<p>更改进程管理器中的值</p>

<div class="wp_code"><div class="pre"><pre class="cpp" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #0000ff;">int</span> APIENTRY WinMain<span style="color: #008000;">&#40;</span>HINSTANCE hInstance,HINSTANCE hPrevInstance,LPSTR lpCmdLine,<span style="color: #0000ff;">int</span> nCmdShow<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#123;</span>
	HWND hwnd<span style="color: #008080;">;</span>
	<span style="color: #0000ff;">int</span> iItem<span style="color: #000080;">=</span><span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
	LVITEM lvitem, <span style="color: #000040;">*</span>plvitem<span style="color: #008080;">;</span>
	DWORD PID<span style="color: #008080;">;</span>
	HANDLE hProcess<span style="color: #008080;">;</span>
	<span style="color: #0000ff;">char</span> <span style="color: #000040;">*</span>p_MyItemText<span style="color: #008080;">;</span><span style="color: #666666;">//目标程序中用来存放TEXT的地址</span>
	<span style="color: #666666;">//The pszText member is the pointer to a null-terminated</span>
	<span style="color: #666666;">// string containing the new text; it can also be NULL.</span>
	<span style="color: #666666;">//以上信息是从API手册中获得的，故在本例中字符串长度不能&gt;=12，</span>
	<span style="color: #666666;">//以确保字符串后有NULL。</span>
	<span style="color: #0000ff;">char</span> str_MyItemText<span style="color: #008000;">&#91;</span><span style="color: #0000dd;">12</span><span style="color: #008000;">&#93;</span><span style="color: #000080;">=</span><span style="color: #008000;">&#123;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#125;</span><span style="color: #008080;">;</span>
	<span style="color: #0000dd;">strcpy</span><span style="color: #008000;">&#40;</span>str_MyItemText,<span style="color: #FF0000;">&quot;天津 赵春生&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
	hwnd<span style="color: #000080;">=</span>FindWindow<span style="color: #008000;">&#40;</span><span style="color: #FF0000;">&quot;#32770&quot;</span>,<span style="color: #FF0000;">&quot;Windows 任务管理器&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
	hwnd<span style="color: #000080;">=</span>FindWindowEx<span style="color: #008000;">&#40;</span>hwnd,<span style="color: #0000dd;">0</span>,<span style="color: #FF0000;">&quot;#32770&quot;</span>,<span style="color: #0000dd;">0</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
	hwnd<span style="color: #000080;">=</span>FindWindowEx<span style="color: #008000;">&#40;</span>hwnd,<span style="color: #0000dd;">0</span>,<span style="color: #FF0000;">&quot;SysListView32&quot;</span>,<span style="color: #0000dd;">0</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
	<span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #000040;">!</span>hwnd<span style="color: #008000;">&#41;</span>
		MessageBox<span style="color: #008000;">&#40;</span><span style="color: #0000ff;">NULL</span>,<span style="color: #FF0000;">&quot;[Windows 任务管理器] 尚未启动！&quot;</span>,<span style="color: #FF0000;">&quot;错误！&quot;</span>,<span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
	<span style="color: #0000ff;">else</span><span style="color: #008000;">&#123;</span>
		GetWindowThreadProcessId<span style="color: #008000;">&#40;</span>hwnd, <span style="color: #000040;">&amp;</span>PID<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
		hProcess<span style="color: #000080;">=</span>OpenProcess<span style="color: #008000;">&#40;</span>PROCESS_ALL_ACCESS,<span style="color: #0000ff;">false</span>,PID<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
		<span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #000040;">!</span>hProcess<span style="color: #008000;">&#41;</span>
			MessageBox<span style="color: #008000;">&#40;</span><span style="color: #0000ff;">NULL</span>,<span style="color: #FF0000;">&quot;获取进程句柄操作失败！&quot;</span>,<span style="color: #FF0000;">&quot;错误！&quot;</span>,<span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
		<span style="color: #0000ff;">else</span><span style="color: #008000;">&#123;</span>
			plvitem<span style="color: #000080;">=</span><span style="color: #008000;">&#40;</span>LVITEM<span style="color: #000040;">*</span><span style="color: #008000;">&#41;</span>VirtualAllocEx<span style="color: #008000;">&#40;</span>hProcess, <span style="color: #0000ff;">NULL</span>, <span style="color: #0000dd;">sizeof</span><span style="color: #008000;">&#40;</span>LVITEM<span style="color: #008000;">&#41;</span>, MEM_COMMIT, PAGE_READWRITE<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
			p_MyItemText<span style="color: #000080;">=</span><span style="color: #008000;">&#40;</span><span style="color: #0000ff;">char</span><span style="color: #000040;">*</span><span style="color: #008000;">&#41;</span>VirtualAllocEx<span style="color: #008000;">&#40;</span>hProcess, <span style="color: #0000ff;">NULL</span>, <span style="color: #0000dd;">12</span>, MEM_COMMIT, PAGE_READWRITE<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
			<span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#40;</span><span style="color: #000040;">!</span>plvitem<span style="color: #008000;">&#41;</span><span style="color: #000040;">||</span><span style="color: #008000;">&#40;</span><span style="color: #000040;">!</span>p_MyItemText<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span>
				MessageBox<span style="color: #008000;">&#40;</span><span style="color: #0000ff;">NULL</span>,<span style="color: #FF0000;">&quot;无法分配内存！&quot;</span>,<span style="color: #FF0000;">&quot;错误！&quot;</span>,<span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
			<span style="color: #0000ff;">else</span><span style="color: #008000;">&#123;</span>
				MessageBox<span style="color: #008000;">&#40;</span><span style="color: #0000ff;">NULL</span>,<span style="color: #FF0000;">&quot;本演示程序将更改TaskManager中第6个项目中第1列的内容。&quot;</span>,<span style="color: #FF0000;">&quot;提示&quot;</span>,<span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
				iItem<span style="color: #000080;">=</span><span style="color: #0000dd;">5</span><span style="color: #008080;">;</span><span style="color: #666666;">//5在这里是第六个（从零开始）</span>
				lvitem.<span style="color: #007788;">iSubItem</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span><span style="color: #008080;">;</span><span style="color: #666666;">//同上</span>
				lvitem.<span style="color: #007788;">pszText</span><span style="color: #000080;">=</span>p_MyItemText<span style="color: #008080;">;</span>
				WriteProcessMemory<span style="color: #008000;">&#40;</span>hProcess, p_MyItemText, <span style="color: #000040;">&amp;</span>str_MyItemText, <span style="color: #0000dd;">12</span>, <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
				WriteProcessMemory<span style="color: #008000;">&#40;</span>hProcess, plvitem, <span style="color: #000040;">&amp;</span>lvitem, <span style="color: #0000dd;">sizeof</span><span style="color: #008000;">&#40;</span>LVITEM<span style="color: #008000;">&#41;</span>, <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
				<span style="color: #666666;">//向目标程序发送LVM_SETITEMTEXT消息</span>
				SendMessage<span style="color: #008000;">&#40;</span>hwnd, LVM_SETITEMTEXT, <span style="color: #008000;">&#40;</span>WPARAM<span style="color: #008000;">&#41;</span>iItem, <span style="color: #008000;">&#40;</span>LPARAM<span style="color: #008000;">&#41;</span>plvitem<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
			<span style="color: #008000;">&#125;</span>
		<span style="color: #008000;">&#125;</span>
	<span style="color: #008000;">&#125;</span>
	<span style="color: #666666;">//释放内存</span>
	CloseHandle<span style="color: #008000;">&#40;</span>hwnd<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
	CloseHandle<span style="color: #008000;">&#40;</span>hProcess<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
	VirtualFreeEx<span style="color: #008000;">&#40;</span>hProcess, plvitem, <span style="color: #0000dd;">0</span>, MEM_RELEASE<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
	VirtualFreeEx<span style="color: #008000;">&#40;</span>hProcess, p_MyItemText, <span style="color: #0000dd;">0</span>, MEM_RELEASE<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
&nbsp;
	<span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
<span style="color: #008000;">&#125;</span></pre></div></div>

]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/7626.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>QTP Action 参数传递</title>
		<link>http://www.xieziming.com/archives/7382.html</link>
		<comments>http://www.xieziming.com/archives/7382.html#respond</comments>
		<pubDate>Mon, 17 Sep 2012 14:29:49 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[QTP]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=7382</guid>
		<description><![CDATA[以QTP的Flight为例子讲下Action参数传递。
<code lang="vb">
SystemUtil.Run "C:\Program Files\Mercury\QuickTest Professional\samples\flight\app\flight4a.exe","","C:\Program Files\Mercury\QuickTest Professional\samples\flight\app\","open"
Dialog("Login").WinEdit("Agent Name:").Set Parameter("InAction1")
wait 5
Dialog("Login").WinEdit("Agent Name:").Type  micTab
Dialog("Login").WinEdit("Password:").SetSecure "4649c633ffc8803c10097292953c6334fde3e923"
Dialog("Login").WinEdit("Password:").Type  micReturn
Window("Flight Reservation").Close
Parameter("OutAction1") = True
</code>
然后，鼠标选中Keyword View中的Action1，点右键---Action Property，在Parameters的Tab标签下，分别加入：输入参数 InAction1 ，类型String；输出参数 OutAction1，类型 Boolean。]]></description>
				<content:encoded><![CDATA[<p>以QTP的Flight为例子讲下Top Level的Action参数传递。</p>

<div class="wp_code"><div class="pre"><pre class="vb" style="font-family:'Times New Roman',Garamond, Times;">SystemUtil.Run <span style="color: #800000;">&quot;C:\Program Files\Mercury\QuickTest Professional\samples\flight\app\flight4a.exe&quot;</span>,<span style="color: #800000;">&quot;&quot;</span>,<span style="color: #800000;">&quot;C:\Program Files\Mercury\QuickTest Professional\samples\flight\app\&quot;</span>,<span style="color: #800000;">&quot;open&quot;</span>
Dialog(<span style="color: #800000;">&quot;Login&quot;</span>).WinEdit(<span style="color: #800000;">&quot;Agent Name:&quot;</span>).<span style="color: #151B8D; font-weight: bold;">Set</span> Parameter(<span style="color: #800000;">&quot;InAction1&quot;</span>)
wait 5
Dialog(<span style="color: #800000;">&quot;Login&quot;</span>).WinEdit(<span style="color: #800000;">&quot;Agent Name:&quot;</span>).<span style="color: #151B8D; font-weight: bold;">Type</span>  micTab
Dialog(<span style="color: #800000;">&quot;Login&quot;</span>).WinEdit(<span style="color: #800000;">&quot;Password:&quot;</span>).SetSecure <span style="color: #800000;">&quot;4649c633ffc8803c10097292953c6334fde3e923&quot;</span>
Dialog(<span style="color: #800000;">&quot;Login&quot;</span>).WinEdit(<span style="color: #800000;">&quot;Password:&quot;</span>).<span style="color: #151B8D; font-weight: bold;">Type</span>  micReturn
Window(<span style="color: #800000;">&quot;Flight Reservation&quot;</span>).<span style="color: #8D38C9; font-weight: bold;">Close</span>
Parameter(<span style="color: #800000;">&quot;OutAction1&quot;</span>) = <span style="color: #00C2FF; font-weight: bold;">True</span></pre></div></div>

<p>然后，鼠标选中Keyword View中的Action1，点右键&#8212;Action Property，在Parameters的Tab标签下，分别加入：输入参数 InAction1 ，类型String；输出参数 OutAction1，类型 Boolean。</p>
<p>再然后，在QTP的菜单File&#8212;>>Settings的Parameters的Tab标签下，分别加入：输入参数 InParam1 ，类型String；输出参数 OutParam1，类型 Boolean。</p>
<p>接着，鼠标还是选中Keyword View中的Action1，点右键，这次点“Action Call Properties”，在Parameter Values里进行参数化传递设置，把InParam1的值传递给InAction1，把OutAction1的值传递给OutParam1。</p>
<p>以上设置完毕后，点“保存”，保存到C:\下，存为Test1好了。</p>
<p>最后，在你的硬盘上新建一个vbs文件，文件内容如下：</p>

<div class="wp_code"><div class="pre"><pre class="vb" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #151B8D; font-weight: bold;">Dim</span> qtApp ,pDefColl,pDef ,rtParams,rtParam 
<span style="color: #151B8D; font-weight: bold;">Set</span> qtApp = <span style="color: #E56717; font-weight: bold;">CreateObject</span>(<span style="color: #800000;">&quot;QuickTest.Application&quot;</span>) 
qtApp.Launch 
qtApp.Visible = <span style="color: #00C2FF; font-weight: bold;">True</span> 
qtApp.<span style="color: #151B8D; font-weight: bold;">Open</span> <span style="color: #800000;">&quot;C:\Test1&quot;</span> 
<span style="color: #151B8D; font-weight: bold;">Set</span> pDefColl = qtApp.Test.ParameterDefinitions 
<span style="color: #008000;">'cnt = pDefColl.Count 
</span><span style="color: #008000;">'Indx = 1 
</span><span style="color: #008000;">'While Indx &lt; = cnt 
</span>    <span style="color: #008000;">'Set pDef = pDefColl.Item(Indx) 
</span>    <span style="color: #008000;">'Indx = Indx + 1 
</span><span style="color: #008000;">'Wend 
</span><span style="color: #151B8D; font-weight: bold;">Set</span> rtParams = pDefColl.GetParameters() 
<span style="color: #151B8D; font-weight: bold;">Set</span> rtParam = rtParams.Item(<span style="color: #800000;">&quot;InParam1&quot;</span>) 
rtParam.Value = <span style="color: #800000;">&quot;songfun&quot;</span> 
qtApp.Test.Run , <span style="color: #00C2FF; font-weight: bold;">True</span>, rtParams
MsgBox rtParams.Item(<span style="color: #800000;">&quot;OutParam1&quot;</span>).Value</pre></div></div>

<p>做完这步之后，保存这个vbs文件，双击执行这个vbs文件，你会发现它自动启动了QTP，而且进行了自动测试，最后还取到了运行成功与否的布尔值。</p>
<p>它的参数的整个传递过程是：</p>
<p>外部vbs文件 传参数给QuickTest的Test的输入参数InParam1，然后InParam1传参数到InAction1去驱动了Action1的测试，然后通过这个Action1得出了OutAction1的值，然后通过OutAction1传给OutParam1，最后再传回到vbs文件中。示例用MsgBox来打出重新传回到vbs文件中的字符串。</p>
]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/7382.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>QTP控制Java程序原理</title>
		<link>http://www.xieziming.com/archives/7366.html</link>
		<comments>http://www.xieziming.com/archives/7366.html#respond</comments>
		<pubDate>Sun, 16 Sep 2012 13:41:43 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[java]]></category>
		<category><![CDATA[QTP]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=7366</guid>
		<description><![CDATA[首先，添加如下环境变量：
<code lang="java">
_JAVA_OPTIONS：
-Xrunjvmhook -Xbootclasspath/a:C:\PROGRA~1\HP\QUICKT~1\bin\JAVA_S~1\classes;C:\PROGRA~1\HP\QUICKT~1\bin\JAVA_S~1\classes\jasmine.jar

JAVA_TOOL_OPTIONS：
-agentlib:jvmhook
</code>
此时再起的JVM的时候会有如下log出现：
<code lang="java">
Picked up JAVA_TOOL_OPTIONS: -agentlib:jvmhook
Picked up _JAVA_OPTIONS: -Xrunjvmhook -Xbootclasspath/a:\PROGRA~1\HP\QUICKT~1\bin\JAVA_S~1\classes;D:\PROGRA~1\HP\QUICKT~1\bin\JAVA_S~1\classes\jasmine.jar
Loading HP QuickTest Professional Java Support (version 10.0.2297.0) (SUN 1.5.0_09)
</code>]]></description>
				<content:encoded><![CDATA[<p>首先，添加如下环境变量：</p>

<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;">_JAVA_OPTIONS：
<span style="color: #339933;">-</span>Xrunjvmhook <span style="color: #339933;">-</span>Xbootclasspath<span style="color: #339933;">/</span>a<span style="color: #339933;">:</span>C<span style="color: #339933;">:</span>\PROGRA~<span style="color: #cc66cc;">1</span>\HP\QUICKT~<span style="color: #cc66cc;">1</span>\bin\JAVA_S~<span style="color: #cc66cc;">1</span>\classes<span style="color: #339933;">;</span>C<span style="color: #339933;">:</span>\PROGRA~<span style="color: #cc66cc;">1</span>\HP\QUICKT~<span style="color: #cc66cc;">1</span>\bin\JAVA_S~<span style="color: #cc66cc;">1</span>\classes\jasmine.<span style="color: #006633;">jar</span>
&nbsp;
JAVA_TOOL_OPTIONS：
<span style="color: #339933;">-</span>agentlib<span style="color: #339933;">:</span>jvmhook</pre></div></div>

<p>此时再起JVM的时候会有如下log出现：</p>

<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;">Picked up JAVA_TOOL_OPTIONS<span style="color: #339933;">:</span> <span style="color: #339933;">-</span>agentlib<span style="color: #339933;">:</span>jvmhook
Picked up _JAVA_OPTIONS<span style="color: #339933;">:</span> <span style="color: #339933;">-</span>Xrunjvmhook <span style="color: #339933;">-</span>Xbootclasspath<span style="color: #339933;">/</span>a<span style="color: #339933;">:</span>\PROGRA~<span style="color: #cc66cc;">1</span>\HP\QUICKT~<span style="color: #cc66cc;">1</span>\bin\JAVA_S~<span style="color: #cc66cc;">1</span>\classes<span style="color: #339933;">;</span>D<span style="color: #339933;">:</span>\PROGRA~<span style="color: #cc66cc;">1</span>\HP\QUICKT~<span style="color: #cc66cc;">1</span>\bin\JAVA_S~<span style="color: #cc66cc;">1</span>\classes\jasmine.<span style="color: #006633;">jar</span>
Loading HP QuickTest Professional Java Support <span style="color: #009900;">&#40;</span>version 10.0.2297.0<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#40;</span>SUN 1.5.0_09<span style="color: #009900;">&#41;</span></pre></div></div>

<p>接下来呢就要利用Java的JVMTI技术来实现对Java程序的控制了。大体的意思就是JVM提供了一些接口,你可以向JVM注册你感兴趣的事件,比如我们这里感兴趣的是JVM加载类的时候,我们希望有途径把我们自己的代码有选择的注入到类里.在JVMTI中,这个事件就是JVMTI_EVENT_CLASS_FILE_LOAD_HOOK .当JVM加载类的时候,会调用我们注册的回调函数,而我们就可以在这个函数里做自己想做的事。</p>
<p>要实现这个目的,就要实现一个动态库,也就是JVMTI中的agent,在这个动态库中,有两个函数是必须的: Agent_OnLoad和Agent_OnUnload,他们是JVM与代理交互的接口.当一个代理被JVM加载后,首先调用Agent_OnLoad 这个方法;同样的,代理被JVM卸载后马上会调用Agent_OnUnload.我们就在Agent_OnLoad这个方法里注册感兴趣的事件,之后 JVM就会在&#8221;有事&#8221;的时候通知我们.要使用agent,就要在启动JVM的时候告诉他要用到那个agent:</p>
<p>java -agentlib:<agentlibname><br />
这个agentLibName就是有我实现的动态库的名字,因系统而定,在Windows是jvmhook.dll,</p>

<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #008000; font-style: italic; font-weight: bold;">/** Will return all methods of a give class */</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">native</span> <span style="color: #003399;">Object</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> getAllObjects<span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">Class</span> clazz<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//native方法，获取当前Object用，定义在jvmhook.dll里。</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">native</span> <span style="color: #003399;">String</span> getMethodName<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">long</span> methodId<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//native方法，定义在jvmhook.dll里。</span>
&nbsp;
<span style="color: #666666; font-style: italic;">//下面是Jboss-Profiler的部分实现代码</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">Object</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> getAllObjects<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> clazz<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #003399;">ArrayList</span> list <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ArrayList</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">Class</span> <span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> classes <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getLoadedClasses</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>i<span style="color: #339933;">&lt;</span>classes .<span style="color: #006633;">length</span><span style="color: #339933;">;</span>i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
        <span style="color: #009900;">&#123;</span>
            <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>classes<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #006633;">getName</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span>clazz<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
            <span style="color: #009900;">&#123;</span>
                <span style="color: #003399;">Object</span> objs<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getAllObjects</span><span style="color: #009900;">&#40;</span>classes<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                <span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> count<span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>count<span style="color: #339933;">&lt;</span>objs.<span style="color: #006633;">length</span><span style="color: #339933;">;</span>count<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
                <span style="color: #009900;">&#123;</span>
                    list.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span>objs<span style="color: #009900;">&#91;</span>count<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                <span style="color: #009900;">&#125;</span>
            <span style="color: #009900;">&#125;</span>
        <span style="color: #009900;">&#125;</span>
        <span style="color: #000000; font-weight: bold;">return</span> list.<span style="color: #006633;">toArray</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">Field</span> getObjectField<span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">Class</span> clazz, <span style="color: #000066; font-weight: bold;">int</span> fieldId<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #003399;">ArrayList</span> list <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ArrayList</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      list.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span>clazz<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #000000; font-weight: bold;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>clazz <span style="color: #339933;">=</span> clazz.<span style="color: #006633;">getSuperclass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">!=</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span>
      <span style="color: #009900;">&#123;</span>
            list.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span>clazz<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #009900;">&#125;</span>
&nbsp;
      <span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span>list.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>i<span style="color: #339933;">&gt;=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>i<span style="color: #339933;">--</span><span style="color: #009900;">&#41;</span>
      <span style="color: #009900;">&#123;</span>
            <span style="color: #003399;">Field</span> fields<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">Class</span><span style="color: #009900;">&#41;</span>list.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>i<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getDeclaredFields</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
            <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>fieldId<span style="color: #339933;">&lt;</span>fields .<span style="color: #006633;">length</span><span style="color: #009900;">&#41;</span>
            <span style="color: #009900;">&#123;</span>
                  <span style="color: #000000; font-weight: bold;">return</span> fields<span style="color: #009900;">&#91;</span>fieldId<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
            <span style="color: #009900;">&#125;</span>
            fieldId <span style="color: #339933;">-=</span> fields.<span style="color: #006633;">length</span><span style="color: #339933;">;</span>
      <span style="color: #009900;">&#125;</span>
      <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span></pre></div></div>

]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/7366.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>LoadRunner测试结果分析</title>
		<link>http://www.xieziming.com/archives/7655.html</link>
		<comments>http://www.xieziming.com/archives/7655.html#respond</comments>
		<pubDate>Wed, 12 Sep 2012 15:06:47 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[LoadRunner]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=7655</guid>
		<description><![CDATA[虚拟用户会在渐增的场景中被增加，不像上图中所有用户同时被加载，在虚拟用户的数量在压力测试计划中到达一个高度之后，会保持这些用户运行一段时间，再使用户数递减，<strong>递减的速度要比递增的快，因为移除用户对服务器几乎没有任何不利影响</strong>。 

无论什么时候，在测试中出现问题，你都应该知道当前场景中的用户数量。压力测试的目的是诊断程序在虚拟压力下出现的问题，所以，当虚拟用户的数量达到某个值时，如果数据在减少，这可以说明程序的不稳定。突发的数据向相反方向的延伸都意味着运行的虚拟用户在增加中 。

每秒点击率的增涨表明服务器负荷的增加，所以<strong>将每秒点击率与事务响应时间和吞吐量对比，可以让你对服务器在压力下的执行有更多理解</strong>。当一个网站服务器正在活动中，每秒点击率将会时常镜像成功的HTTP响应信号的总数。

Throughput是基于字节/秒来传输的，它描述通过网络服务器传输的数据在网络上任意事件发生时的传输量。完美的吞吐量应该是随着每秒点击率的增加而增加，这种增加是建立在带宽足够处理用户提出的所有请求的基础上的。 ]]></description>
				<content:encoded><![CDATA[<p>虚拟用户会在渐增的场景中被增加，不像上图中所有用户同时被加载，在虚拟用户的数量在压力测试计划中到达一个高度之后，会保持这些用户运行一段时间，再使用户数递减，<strong>递减的速度要比递增的快，因为移除用户对服务器几乎没有任何不利影响</strong>。 </p>
<p>无论什么时候，在测试中现问题，你都应该知道当前场景中的用户数量。压力测试的目的是诊断程序在虚拟压力下出现的问题，所以，当虚拟用户的数量达到某个值时，如果数据在减少，这可以说明程序的不稳定。突发的数据向相反方向的延伸都意味着运行的虚拟用户在增加中 。</p>
<p>每秒点击率的增涨表明服务器负荷的增加，所以<strong>将每秒点击率与事务响应时间和吞吐量对比，可以让你对服务器在压力下的执行有更多理解</strong>。当一个网站服务器正在活动中，每秒点击率将会时常镜像成功的HTTP响应信号的总数。</p>
<p>Throughput是基于字节/秒来传输的，它描述通过网络服务器传输的数据在网络上任意事件发生时的传输量。完美的吞吐量应该是随着每秒点击率的增加而增加，这种增加是建立在带宽足够处理用户提出的所有请求的基础上的。 </p>
<p>在比较吞吐量和每秒的点击率中你可以获得服务器在执行过程中的信息。如果服务器如预期的一样在执行，那么吞吐量会随着它每秒的点击量的增加而增加。这是期望实现的情况，因为点击增加一次就会需要服务器发送更多的返回信息给用户。无论如何，<strong>如果点击的次数增加而吞吐量恒定或减少，就说明服务器无法执行增加的请求（每秒点击率），结果就是事务反应时间的增加</strong>。</p>
<p>如果一台服务器的业务量低于最大负载量，则每秒点击率通常会映射吞吐量。更多用户将会引起每秒点击率的增长，并且当服务器不再处理大量的请求的时候，吞吐量将会减少。  </p>
<p>平均事务处理时间图表显示了平均每个事务的结束的反应时间。<strong>反应时间是从客户端请求到服务器响应的全部时间</strong>。通常的响应时间会与当前在测试场景中运行的Vusers的数量一致。 </p>
<p>响应时间增加的最通常的原因是运行的用户增加，因为随着用户进入测试场景的增加，服务器的工作量也会增加。服务器会花时间去响应一个增加的负载，于是平均响应时间就会增长。</p>
<p>在规定时间内测试场景中的每秒事务数与运行的虚拟用户数相一致，并且随着虚拟用户的增加，每秒事务数也会增加。如果随着虚拟用户的增加，每秒事务数会减少，这时场景中很可能出现了问题。你应该先<strong>对比运行的虚拟用户数量与每秒事务图，以核实一次虚拟用户的增加是否导致每秒点击率、事务响应时间和吞吐量的增加</strong>，将这些统计数据放到一起会帮助你找出问题发生的主要原因 。</p>
<p><strong>平缓的加载使你可以侦测到当虚拟用户数量达到多少时，事务响应时间会出现不好的变化</strong>。通过对比测试时间表与事务响应时间图表，你可以确定响应时间的一个峰值与虚拟用户的增长是否相对应，否则你只能在其它地方找到问题出现的原因。</p>
]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/7655.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>QTP自动化框架建设</title>
		<link>http://www.xieziming.com/archives/8475.html</link>
		<comments>http://www.xieziming.com/archives/8475.html#respond</comments>
		<pubDate>Sat, 24 Mar 2012 04:24:40 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[Automation]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=8475</guid>
		<description><![CDATA[其实自动化测试框架就是一种规范的集合体，在自动化测试团队开发过程中，经常会遇到很多这样和那样的问题，例如：

（1）测试脚本不统一，出现很多重复脚本；
（2）在对象库中含有很多重复对象，导致对象混乱；
（3）测试脚本全部为Hard Code，没有实现部分可配置，导致维护成本过大。

以上这些只是一些比较常见的问题，其实在自动化测试过程当中遇到的问题还远远不止这些，那么要解决这些问题，就必须要为其定义适合项目的规范。例如，脚本不统一，可以对每个脚本写法定义严格的规范，定制共享函数库；对象库重复混乱，可以使用共享对象库来解决；测试脚本全部为Hard Code，则可以把部分的关键字进行分离。

下面我主要通过三个方面来阐述我的一点框架测试建议。

<font color="#00BB00"><strong>1. 测试数据</strong></font>
对于规模不大的自动化测试，我建议采用Excel来组织你的测试数据。当然，我们还是要采取分层的方式，有一张总表以及具体的细表。每条test data都有它自己的工作流。工作方式类似的如下方式：

QTP载入Excel数据文件，通过遍历总表所有行来执行所有的test cases。在这个大循环内，通过总表的索引取出细表的数据，然后以列名为key存放在VBS里的字典里，在脚本中用的时候直接TestDataDictionary.Item("Column_Name")取出即可。

<font color="#00BB00"><strong>2. 工作流</strong></font>
建议采用XML来组织你的workflow，下面是个简单的例子：
<code lang="xml">
<flow_forA>
<function> function_step1</function>
<function> function_step2</function>
<function> function_step3</function>
</flow_forA>
</code>
比如我们在测试数据中给该test cases定的工作流是flow_forA，则QTP在执行的时候会去work flows里找到名字叫flow_forA的节点，并遍历执行它的子节点函数来完成这个工作流。]]></description>
				<content:encoded><![CDATA[<p>其实自动化测试框架就是一种规范的集合体，在自动化测试团队开发过程中，经常会遇到很多这样和那样的问题，例如：</p>
<p>（1）测试脚本不统一，出现很多重复脚本；<br />
（2）在对象库中含有很多重复对象，导致对象混乱；<br />
（3）测试脚本全部为Hard Code，没有实现部分可配置，导致维护成本过大。</p>
<p>以上这些只是一些比较常见的问题，其实在自动化测试过程当中遇到的问题还远远不止这些，那么要解决这些问题，就必须要为其定义适合项目的规范。例如，脚本不统一，可以对每个脚本写法定义严格的规范，定制共享函数库；对象库重复混乱，可以使用共享对象库来解决；测试脚本全部为Hard Code，则可以把部分的关键字进行分离。</p>
<p>下面我主要通过三个方面来阐述我的一点框架测试建议。</p>
<p><font color="#00BB00"><strong>1. 测试数据</strong></font><br />
对于规模不大的自动化测试，我建议采用Excel来组织你的测试数据。当然，我们还是要采取分层的方式，有一张总表以及具体的细表。每条test data都有它自己的工作流。工作方式类似的如下方式：</p>
<p>QTP载入Excel数据文件，通过遍历总表所有行来执行所有的test cases。在这个大循环内，通过总表的索引取出细表的数据，然后以列名为key存放在VBS里的字典里，在脚本中用的时候直接TestDataDictionary.Item(&#8220;Column_Name&#8221;)取出即可。</p>
<p><font color="#00BB00"><strong>2. 工作流</strong></font><br />
建议采用XML来组织你的workflow，下面是个简单的例子：</p>

<div class="wp_code"><div class="pre"><pre class="xml" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;flow_forA<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;function<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> function_step1<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/function<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;function<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> function_step2<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/function<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
     <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;function<span style="color: #000000; font-weight: bold;">&gt;</span></span></span> function_step3<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/function<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/flow_forA<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></div></div>

<p>比如我们在测试数据中给该test cases定的工作流是flow_forA，则QTP在执行的时候会去work flows里找到名字叫flow_forA的节点，并遍历执行它的子节点函数来完成这个工作流。每个函数都有一个返回值来表示执行结果，当其中某个结果为fail的时候，QTP应该退出执行。</p>
<p><font color="#00BB00"><strong>3. 多进程</strong></font></p>
<p>QTP有两个不好的地方，一个是它的脚本执行/对象识别速度过慢。另一个是它的独占性，一台PC只能有一个QTP实例。第一个缺点我们还能通过优化对象识别方法来克服，而第二个我们就无能为力了。。。。</p>
<p>这样一来，为了加快测试执行，我们通常需要同时在几台PC上运行QTP。那怎么来分配我们的test cases给QTP以及收集测试结果呢？</p>
<p>最原始的方法可能是给每台PC分配独有的test cases，最后把这些PC上的运行结果收集在一起。这样做有几个缺点：（1）PC使用率不够高。因为分配到的test cases数量和运行时间的差异，总有些PC会在其他PC还在运行时结束，这就造成了测试资源的闲置。（2）需要额外的精力来收集各PC的运行结果。（3）当某些PC意外停止运行的时候（QTP错误，PC死机等），分配给它的test cases就无法被执行了。</p>
<p>基于上述考虑，我建议使用shared folder或者数据库来同步各PC.每台PC都有完整的test cases列表，在loop这个列表时去取该test case当时的状态，是还没被执行，正在被执行还是已经执行完毕了。同时，在运行这个test case的时候更新它的状态。下面以share folder方式为例子来具体讲下。</p>
<p>（1）每台PC的测试脚本以及测试数据都是一样的，都配置了test cases status的shared folder路径。比如\\testing_pc\test_case_status<br />
（2）各PC载入完整的测试数据（测试用例列表），在Loop这个列表的时候，去shared folder查询当前要执行的test case的状态，如果没有任何信息，说明还没被执行过，这时创建一个文件来更新该test case的状态，比如创建\\testing_pc\test_case_status\\testcase_A.lock。如果该test case是lock状态说明正在被执行，于是放弃执行，转至下一个test case。<br />
（3）当某test case执行完毕或者错误退出时，删除lock状态。</p>
]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/8475.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Application Monitor</title>
		<link>http://www.xieziming.com/archives/6661.html</link>
		<comments>http://www.xieziming.com/archives/6661.html#respond</comments>
		<pubDate>Wed, 11 May 2011 11:57:15 +0000</pubDate>
		<dc:creator><![CDATA[Suny Tse]]></dc:creator>
				<category><![CDATA[测试]]></category>
		<category><![CDATA[java]]></category>
		<category><![CDATA[QTP]]></category>
		<category><![CDATA[程序]]></category>

		<guid isPermaLink="false">http://www.xieziming.com/?p=6661</guid>
		<description><![CDATA[<code lang="java">
import java.awt.AWTException;  
import java.awt.Image;  
import java.awt.MenuItem;  
import java.awt.PopupMenu;  
import java.awt.SystemTray;  
import java.awt.Toolkit;  
import java.awt.TrayIcon;  
import java.awt.event.ActionEvent;  
import java.awt.event.ActionListener;  
  
import javax.swing.JDialog;
import javax.swing.JFrame;  
import javax.swing.JOptionPane;
  
  
public class Launcher{  
      
    public Launcher() {  
         this.setTray();  
         QTPMonitor qtpm= new QTPMonitor();
         qtpm.start();
    }  
</code>]]></description>
				<content:encoded><![CDATA[<p>These monitor program includes 3 class files as follows:</p>
<p><strong>Launcher.java</strong></p>

<div class="wp_code"><div class="pre"><pre class="java" style="font-family:'Times New Roman',Garamond, Times;"><span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.awt.AWTException</span><span style="color: #339933;">;</span>  
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.awt.Image</span><span style="color: #339933;">;</span>  
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.awt.MenuItem</span><span style="color: #339933;">;</span>  
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.awt.PopupMenu</span><span style="color: #339933;">;</span>  
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.awt.SystemTray</span><span style="color: #339933;">;</span>  
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.awt.Toolkit</span><span style="color: #339933;">;</span>  
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.awt.TrayIcon</span><span style="color: #339933;">;</span>  
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.awt.event.ActionEvent</span><span style="color: #339933;">;</span>  
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.awt.event.ActionListener</span><span style="color: #339933;">;</span>  
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.swing.JDialog</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.swing.JFrame</span><span style="color: #339933;">;</span>  
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.swing.JOptionPane</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> Launcher<span style="color: #009900;">&#123;</span>  
&nbsp;
    <span style="color: #000000; font-weight: bold;">public</span> Launcher<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>  
         <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">setTray</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  
         QTPMonitor qtpm<span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> QTPMonitor<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
         qtpm.<span style="color: #006633;">start</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>  
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setTray<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>  
&nbsp;
        <span style="color: #000000; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>SystemTray.<span style="color: #006633;">isSupported</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
            <span style="color: #003399;">PopupMenu</span> popMenu <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PopupMenu</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  
            <span style="color: #003399;">MenuItem</span> itemAbout <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">MenuItem</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;About&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  
            itemAbout.<span style="color: #006633;">addActionListener</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ActionListener</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>  
                <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> actionPerformed<span style="color: #009900;">&#40;</span><span style="color: #003399;">ActionEvent</span> e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>  
                	<span style="color: #003399;">Object</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> options <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span><span style="color: #0000ff;">&quot;I SEE&quot;</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
                	<span style="color: #003399;">JOptionPane</span>.<span style="color: #006633;">showOptionDialog</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">null</span>, <span style="color: #0000ff;">&quot;SUNY Z M XIE, XFOS, GBM_ITT&quot;</span>, <span style="color: #0000ff;">&quot;About QTP Monitor&quot;</span>,<span style="color: #003399;">JOptionPane</span>.<span style="color: #006633;">YES_OPTION</span>, <span style="color: #003399;">JOptionPane</span>.<span style="color: #006633;">INFORMATION_MESSAGE</span>, <span style="color: #000066; font-weight: bold;">null</span>, options, options<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                <span style="color: #009900;">&#125;</span>                 
            <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  
&nbsp;
            <span style="color: #003399;">MenuItem</span> itmExit <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">MenuItem</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Stop &amp; Exit&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  
            itmExit.<span style="color: #006633;">addActionListener</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ActionListener</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>  
                <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> actionPerformed<span style="color: #009900;">&#40;</span><span style="color: #003399;">ActionEvent</span> e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>  
                	<span style="color: #003399;">System</span>.<span style="color: #006633;">exit</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  
                <span style="color: #009900;">&#125;</span>  
            <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  
            popMenu.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span>itemAbout<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
            popMenu.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span>itmExit<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  
&nbsp;
            SystemTray tray <span style="color: #339933;">=</span> SystemTray.<span style="color: #006633;">getSystemTray</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  
            <span style="color: #003399;">Image</span> image <span style="color: #339933;">=</span> <span style="color: #003399;">Toolkit</span>.<span style="color: #006633;">getDefaultToolkit</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getImage</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;trayIconImage/sina.jpg&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  
&nbsp;
            <span style="color: #003399;">String</span> text <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;QTP Monitor&quot;</span><span style="color: #339933;">;</span>  
            TrayIcon trayIcon <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> TrayIcon<span style="color: #009900;">&#40;</span>image,text,popMenu<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  
            <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>  
                tray.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span>trayIcon<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  
            <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">AWTException</span> e1<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>  
                e1.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  
            <span style="color: #009900;">&#125;</span>  
        <span style="color: #009900;">&#125;</span>  
    <span style="color: #009900;">&#125;</span>  
&nbsp;
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> showSetting<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    	<span style="color: #003399;">JDialog</span> JDG_about <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">JDialog</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	JDG_about.<span style="color: #006633;">setTitle</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;About QTP Monitor&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	JDG_about.<span style="color: #006633;">setSize</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">200</span>,<span style="color: #cc66cc;">100</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
    	JDG_about.<span style="color: #006633;">setDefaultCloseOperation</span><span style="color: #009900;">&#40;</span><span style="color: #003399;">JDialog</span>.<span style="color: #006633;">DISPOSE_ON_CLOSE</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #003399;">Toolkit</span> tk <span style="color: #339933;">=</span> <span style="color: #003399;">Toolkit</span>.<span style="color: #006633;">getDefaultToolkit</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	JDG_about.<span style="color: #006633;">setLocation</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>tk.<span style="color: #006633;">getScreenSize</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">height</span> <span style="color: #339933;">-</span>JDG_about.<span style="color: #006633;">HEIGHT</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">/</span><span style="color: #cc66cc;">2</span>, <span style="color: #009900;">&#40;</span>tk.<span style="color: #006633;">getScreenSize</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">width</span> <span style="color: #339933;">-</span> JDG_about.<span style="color: #006633;">WIDTH</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">/</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      	JDG_about.<span style="color: #006633;">setVisible</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">void</span> main<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> args<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>  
        <span style="color: #000000; font-weight: bold;">new</span> Launcher<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  
    <span style="color: #009900;">&#125;</span>  
<span style="color: #009900;">&#125;</span></pre></div></div>

]]></content:encoded>
			<wfw:commentRss>http://www.xieziming.com/archives/6661.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
	</channel>
</rss>
